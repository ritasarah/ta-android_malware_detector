import java.io.BufferedReader;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.util.HashMap;
import java.util.Map;
import java.util.TreeMap;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
 * Created by Rita on 4/12/2016.
 */
public class Manifest {
    // declares an array of integers
    Map<String,Boolean> permission;
    int apilevel;

    Manifest(){// allocates memory for 10 integers
        permission = new TreeMap<String,Boolean>();

        BufferedReader br  = null;
//        StringBuilder result = new StringBuilder();

        try {
            String sCurrentLine;
            br = new BufferedReader(new FileReader("permission.txt"));
            while ((sCurrentLine = br.readLine())!=null){
                permission.put(sCurrentLine, false);
            }
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        }

    }

    public void getPermission(){
        BufferedReader br  = null;
        StringBuilder result = new StringBuilder();

        try {
            String sCurrentLine;
            br = new BufferedReader(new FileReader("output_folder/AndroidManifest.xml"));
            while ((sCurrentLine = br.readLine())!=null){
                result.append(sCurrentLine);
            }
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        }
        System.out.println(result);

        String permissionRegex="permission\\.(.+?)\"" ;
        Pattern permissionPattern = Pattern.compile(permissionRegex);
        Matcher permissionMatcher = permissionPattern.matcher(result);

        while(permissionMatcher.find()){
            String s = permissionMatcher.group(0);
            s = s.substring(0,s.length()-1);
            s = s.replaceAll("permission.","");

            if (permission.containsKey(s)){
                permission.put(s,true);
            }

            System.out.println(s);
        }

    }

    public void getAPILevel(){
        BufferedReader br  = null;
        StringBuilder result = new StringBuilder();

        try {
            String sCurrentLine;
            br = new BufferedReader(new FileReader("output_folder/AndroidManifest.xml"));
            while ((sCurrentLine = br.readLine())!=null){
                result.append(sCurrentLine);
            }
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        }
        System.out.println(result);

        String permissionRegex="platformBuildVersionCode=\"(\\d+)\"" ;
        Pattern permissionPattern = Pattern.compile(permissionRegex);
        Matcher permissionMatcher = permissionPattern.matcher(result);

        while(permissionMatcher.find()){
            String s = permissionMatcher.group(0);
            s = s.replaceAll("platformBuildVersionCode=","");
            s = s.substring(1,s.length()-1);

            apilevel = Integer.parseInt(s);

        }

    }

    public void printPermission(){
        System.out.println(permission.toString());
    }

    public void printAPILevel() {
        System.out.println(apilevel);
    }


}
