import jadx.api.JadxDecompiler;
import jadx.core.Jadx;
import jadx.core.utils.exceptions.JadxException;
import libsvm.svm_model;
import libsvm.svm_problem;
import org.apache.commons.io.FileUtils;
import org.apache.commons.io.FilenameUtils;
import weka.core.Instances;

import java.io.*;
import java.util.ArrayList;
import java.util.Map;
import java.util.Scanner;
import java.util.concurrent.*;

/**
 * Created by Rita on 3/10/2016.
 */


public class Main {


    public static void main(String[] args) {

        JadxUtil jUtil = new JadxUtil();
        ClassificationUtil cUtil = new ClassificationUtil();
        ClassificationUtil cUtil2 = new ClassificationUtil();

        int menu;

        svm_problem prob;
        svm_model model = null;

        System.out.println("Menu");
        System.out.println("1. Create Dataset ");
        System.out.println("2. Generate Model and Cross Validation");
        System.out.println("3. Input Test in folder [test]");
        System.out.println("4. Info Gain Attribute Selection");
        System.out.println("9. Quit");
        System.out.print("Input : ");

        Scanner input = new Scanner(System.in);

        menu = input.nextInt();

        while(menu != 9 ) {
             if (menu == 1 ){
                jUtil.getAllApk("apk/","cobacoba.arff");
             } else if (menu == 2 ){
                //model
                Instances trainInstances = cUtil.loadARFF("reduct300.arff", 0);

//                 trainingfull1pjg2
                cUtil.setParam();
                prob = cUtil.defineProblem(trainInstances);
                model = cUtil.trainClassifier(prob);

                cUtil.saveClassifier(model,"modelfull.model");

                //crossvalidation
                cUtil.crossValidation(prob,10,3);

                //test
//                Instances testInstances = cUtil.loadARFF("testmini.arff",157);
//                cUtil.classifyInstances(model,testInstances);
             } else if (menu == 3 ){
                //input apk
                model = cUtil.loadModel("modelfull.model");

    //            jUtil.getAllApk("test/");
    //            cUtil.createTestInstances(jUtil.getManifests(),"test.arff");

                Instances testInstances2 = cUtil.loadARFF("reduct300b.arff",0);

                cUtil2.classifyInstancesEval(model,testInstances2);
            }
            else if (menu == 4 ){
                 cUtil.AttrRanker(cUtil.loadARFF("reduct300.arff",0),"infogain");
             }
            else if (menu == 5 ){

                 for (int i = 2; i <130 ; i++) {
//                 int i = 2 ;
                     Instances newInst = cUtil.removeAttr("reductrain.arff", i);
//                     System.out.println(newInst);
                     cUtil.setParam();
                     prob = cUtil.defineProblem(newInst);
                     model = cUtil.trainClassifier(prob);

                     cUtil.saveClassifier(model, "modeltest.model");
                     //crossvalidation
                     cUtil.crossValidation(prob, 10, 3);

                 }

             }
            else if (menu ==6){
                 int idxs[]  = {41,45,47,95,114,118}; //dr reduct 400
//                 int idxs[]  = {3,4,16,20,23,26,28,29,40,49,53,56,57,58,59,72,77,79,86,95,98,100,120,126}; //dr reduct 200

                 Instances newi = cUtil.removeAttrs("reduct300.arff",idxs);
                 cUtil.setParam();
                 prob = cUtil.defineProblem(newi);
                 model = cUtil.trainClassifier(prob);

                 cUtil.saveClassifier(model, "modeltest.model");
                 //crossvalidation
                 cUtil.crossValidation(prob, 10, 3);

             }

            System.out.println("Menu");
            System.out.println("1. Create Dataset ");
            System.out.println("2. Generate Model and Cross Validation");
            System.out.println("3. Input Test in folder [test]");
            System.out.println("4. Info Gain Attribute Selection");
            System.out.println("9. Quit");
            System.out.print("Input : ");

            menu = input.nextInt();
        }


    }
}
