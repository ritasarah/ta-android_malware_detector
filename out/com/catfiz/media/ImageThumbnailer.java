package com.catfiz.media;

import android.content.Context;
import android.media.ExifInterface;
import android.net.Uri;
import android.os.AsyncTask;
import com.catfiz.util.Utils;
import java.io.File;
import java.io.IOException;
import org.apache.commons.logging.impl.SimpleLog;
import org.apache.http.conn.routing.HttpRouteDirector;

public class ImageThumbnailer extends AsyncTask {
    private static final String TAG = "ImageThumbnailer";
    private String filepath = null;
    private int mByteStreamType = 0;
    private float mCoefSize = 1.0f;
    private Context mContext = null;
    private String mImagePath = null;
    private Uri mImageUri = null;
    private String mPinCode = null;
    private boolean video = false;

    public ImageThumbnailer(Context context, String str, int i) {
        this.mContext = context;
        this.mPinCode = str;
        this.mByteStreamType = i;
    }

    public ImageThumbnailer(Context context, String str, int i, float f) {
        this.mContext = context;
        this.mPinCode = str;
        this.mByteStreamType = i;
        this.mCoefSize = f;
    }

    public ImageThumbnailer(Context context, String str, int i, boolean z, String str2) {
        this.filepath = str2;
        this.video = z;
        this.mContext = context;
        this.mPinCode = str;
        this.mByteStreamType = i;
    }

    public ImageThumbnailer(Context context, String str, int i, boolean z, String str2, float f) {
        this.filepath = str2;
        this.video = z;
        this.mContext = context;
        this.mPinCode = str;
        this.mByteStreamType = i;
        this.mCoefSize = f;
    }

    public static int getExifRotation(File file) {
        if (file == null) {
            return 0;
        }
        try {
            switch (new ExifInterface(file.getAbsolutePath()).getAttributeInt("Orientation", 0)) {
                case e.c /*2*/:
                    return 90;
                case HttpRouteDirector.TUNNEL_TARGET /*3*/:
                    return 180;
                case HttpRouteDirector.TUNNEL_PROXY /*4*/:
                    return 180;
                case SimpleLog.LOG_LEVEL_FATAL /*6*/:
                    return 90;
                case Utils.FILE_TYPE_INSTALLER /*8*/:
                    return 270;
                default:
                    return 0;
            }
        } catch (IOException e) {
            return 0;
        }
    }

    /* JADX WARNING: inconsistent code. */
    /* Code decompiled incorrectly, please refer to instructions dump. */
    protected android.net.Uri doInBackground(android.net.Uri... r14) {
        /*
        r13 = this;
        r1 = 1;
        r2 = 0;
        r7 = 0;
        r0 = r14.length;
        if (r0 == r1) goto L_0x000e;
    L_0x0006:
        r0 = new java.lang.IllegalArgumentException;
        r1 = "We expect to process only one Uri";
        r0.<init>(r1);
        throw r0;
    L_0x000e:
        r0 = r14[r2];
        r0 = r0.getPath();
        r2 = "ImageThumbnailer";
        r3 = new java.lang.StringBuilder;
        r3.<init>();
        r4 = "path=";
        r3 = r3.append(r4);
        r0 = r3.append(r0);
        r0 = r0.toString();
        com.catfiz.util.Log.d(r2, r0);
        r0 = r13.video;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        if (r0 == 0) goto L_0x0048;
    L_0x0030:
        r0 = r13.filepath;	 Catch:{ Exception -> 0x0045, FileNotFoundException -> 0x0168 }
        r1 = 3;
        r0 = android.media.ThumbnailUtils.createVideoThumbnail(r0, r1);	 Catch:{ Exception -> 0x0045, FileNotFoundException -> 0x0168 }
    L_0x0037:
        if (r0 != 0) goto L_0x00fc;
    L_0x0039:
        r0 = "ImageThumbnailer";
        r1 = "null thumb";
        com.catfiz.util.Log.d(r0, r1);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r0 = 0;
        r13.mContext = r0;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r0 = r7;
    L_0x0044:
        return r0;
    L_0x0045:
        r0 = move-exception;
        r0 = r7;
        goto L_0x0037;
    L_0x0048:
        r3 = new android.graphics.BitmapFactory$Options;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r3.<init>();	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r0 = 1;
        r3.inJustDecodeBounds = r0;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r0 = r13.mContext;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r0 = r0.getContentResolver();	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r2 = 0;
        r2 = r14[r2];	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r0 = r0.openInputStream(r2);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r2 = 0;
        android.graphics.BitmapFactory.decodeStream(r0, r2, r3);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r0 = r3.outHeight;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r0 = (float) r0;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r2 = 1120403456; // 0x42c80000 float:100.0 double:5.53552857E-315;
        r0 = (r0 > r2 ? 1 : (r0 == r2 ? 0 : -1));
        if (r0 > 0) goto L_0x00eb;
    L_0x006a:
        r0 = 1137180672; // 0x43c80000 float:400.0 double:5.61841903E-315;
        r2 = r13.mCoefSize;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r2 = r2 * r0;
        r0 = 1120403456; // 0x42c80000 float:100.0 double:5.53552857E-315;
        r4 = r13.mCoefSize;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r0 = r0 * r4;
        r12 = r0;
        r0 = r2;
        r2 = r12;
    L_0x0077:
        r4 = r3.outWidth;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r4 = r3.outHeight;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r4 = r3.outWidth;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r4 = (float) r4;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r4 = (r4 > r0 ? 1 : (r4 == r0 ? 0 : -1));
        if (r4 <= 0) goto L_0x0188;
    L_0x0082:
        r4 = 4611686018427387904; // 0x4000000000000000 float:0.0 double:2.0;
        r8 = (double) r0;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r0 = r3.outWidth;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r10 = (double) r0;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r8 = r8 / r10;
        r8 = java.lang.Math.log(r8);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r10 = 4602678819172646912; // 0x3fe0000000000000 float:0.0 double:0.5;
        r10 = java.lang.Math.log(r10);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r8 = r8 / r10;
        r8 = java.lang.Math.round(r8);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r0 = (int) r8;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r8 = (double) r0;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r4 = java.lang.Math.pow(r4, r8);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r0 = (int) r4;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
    L_0x009f:
        r4 = r3.outHeight;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r4 = (float) r4;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r4 = (r4 > r2 ? 1 : (r4 == r2 ? 0 : -1));
        if (r4 <= 0) goto L_0x00c4;
    L_0x00a6:
        r4 = 4611686018427387904; // 0x4000000000000000 float:0.0 double:2.0;
        r8 = (double) r2;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r1 = r3.outHeight;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r2 = (double) r1;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r2 = r8 / r2;
        r2 = java.lang.Math.log(r2);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r8 = 4602678819172646912; // 0x3fe0000000000000 float:0.0 double:0.5;
        r8 = java.lang.Math.log(r8);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r2 = r2 / r8;
        r2 = java.lang.Math.round(r2);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r1 = (int) r2;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r2 = (double) r1;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r2 = java.lang.Math.pow(r4, r2);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r1 = (int) r2;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
    L_0x00c4:
        if (r0 <= r1) goto L_0x00fa;
    L_0x00c6:
        r1 = new android.graphics.BitmapFactory$Options;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r1.<init>();	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r1.inSampleSize = r0;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r0 = 0;
        r1.inJustDecodeBounds = r0;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r0 = 0;
        r1.inDither = r0;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r0 = android.graphics.Bitmap.Config.ARGB_8888;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r1.inPreferredConfig = r0;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r0 = r13.mContext;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r0 = r0.getContentResolver();	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r2 = 0;
        r2 = r14[r2];	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r0 = r0.openInputStream(r2);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r2 = 0;
        r0 = android.graphics.BitmapFactory.decodeStream(r0, r2, r1);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        goto L_0x0037;
    L_0x00eb:
        r0 = 1131413504; // 0x43700000 float:240.0 double:5.589925436E-315;
        r2 = r13.mCoefSize;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r2 = r2 * r0;
        r0 = 1131413504; // 0x43700000 float:240.0 double:5.589925436E-315;
        r4 = r13.mCoefSize;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r0 = r0 * r4;
        r12 = r0;
        r0 = r2;
        r2 = r12;
        goto L_0x0077;
    L_0x00fa:
        r0 = r1;
        goto L_0x00c6;
    L_0x00fc:
        r1 = new java.io.File;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r2 = 0;
        r2 = r14[r2];	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r2 = r2.getPath();	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r1.<init>(r2);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r1 = getExifRotation(r1);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        if (r1 == 0) goto L_0x013e;
    L_0x010e:
        r2 = "ImageThumbnailer";
        r3 = new java.lang.StringBuilder;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r3.<init>();	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r4 = "ROTATE: ";
        r3 = r3.append(r4);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r3 = r3.append(r1);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r3 = r3.toString();	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        com.catfiz.util.Log.d(r2, r3);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r5 = new android.graphics.Matrix;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r5.<init>();	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r1 = (float) r1;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r5.setRotate(r1);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r1 = 0;
        r2 = 0;
        r3 = r0.getWidth();	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r4 = r0.getHeight();	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r6 = 1;
        r0 = android.graphics.Bitmap.createBitmap(r0, r1, r2, r3, r4, r5, r6);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
    L_0x013e:
        r1 = r13.mContext;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r2 = r13.mPinCode;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r1 = com.catfiz.media.CatfishPhotoStorage.getDownloadThumbFile(r1, r2);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r2 = new java.io.FileOutputStream;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r2.<init>(r1);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r3 = android.graphics.Bitmap.CompressFormat.PNG;	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r4 = 80;
        r0.compress(r3, r4, r2);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r0.recycle();	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r2.flush();	 Catch:{ IOException -> 0x0163 }
        r2.close();	 Catch:{ IOException -> 0x0163 }
    L_0x015b:
        r0 = android.net.Uri.fromFile(r1);	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        r13.mContext = r7;
        goto L_0x0044;
    L_0x0163:
        r0 = move-exception;
        r0.printStackTrace();	 Catch:{ FileNotFoundException -> 0x0168, Exception -> 0x0178 }
        goto L_0x015b;
    L_0x0168:
        r0 = move-exception;
        r1 = "ImageThumbnailer";
        r2 = "FAIL TO SAVE THE THUMBNAIL";
        com.catfiz.util.Log.e(r1, r2);
        r0.printStackTrace();
        r13.mContext = r7;
        r0 = r7;
        goto L_0x0044;
    L_0x0178:
        r0 = move-exception;
        r1 = "ImageThumbnailer";
        r2 = "FATAL ERROR WHEN CREATE THE THUMBNAIL";
        com.catfiz.util.Log.e(r1, r2);
        r0.printStackTrace();
        r13.mContext = r7;
        r0 = r7;
        goto L_0x0044;
    L_0x0188:
        r0 = r1;
        goto L_0x009f;
        */
        throw new UnsupportedOperationException("Method not decompiled: com.catfiz.media.ImageThumbnailer.doInBackground(android.net.Uri[]):android.net.Uri");
    }
}
