package com.catfiz.ecash.api;

import com.catfiz.ecash.ECash;
import com.catfiz.ecash.api.ResponseStatus.StatusCode;
import com.catfiz.ecash.model.ECashAccount;
import com.catfiz.ecash.model.ECashCredentials;
import com.catfiz.service.FriendListDataStorage;
import java.util.ArrayList;
import java.util.List;
import org.apache.http.message.BasicNameValuePair;
import org.json.JSONObject;

public class Login extends ApiBase {
    private String mSecurePin = null;

    public Login(String str) {
        this.mSecurePin = str;
    }

    public List generateRequest() {
        List arrayList = new ArrayList();
        arrayList.add(new BasicNameValuePair("uid", ECash.getUid()));
        arrayList.add(new BasicNameValuePair("credentials", this.mSecurePin));
        return arrayList;
    }

    public String getUrl() {
        return ApiUrl.getUrl(Operation.LOGIN);
    }

    public void onPostResponse(Result result) {
        if (result.getStatusCode() == StatusCode.RESPONSE_PROCESSED) {
            ECashAccount eCashAccount = (ECashAccount) result.getResultData();
            eCashAccount.getCredentials().setPin(this.mSecurePin);
            ECash.storeAccount(eCashAccount);
        }
    }

    public Result parseResponse(String str) {
        Result result = new Result();
        ECashAccount eCashAccount = new ECashAccount();
        ECashCredentials eCashCredentials = new ECashCredentials();
        eCashAccount.setCredentials(eCashCredentials);
        result.setResultData(eCashAccount);
        JSONObject jSONObject = new JSONObject(str);
        if (jSONObject.has(FriendListDataStorage.STATUS)) {
            result.setStatus(jSONObject.getString(FriendListDataStorage.STATUS));
            result.setStatusCode(ResponseStatus.getResponseCode(jSONObject.getString(FriendListDataStorage.STATUS)));
        }
        if (jSONObject.has("msisdn")) {
            eCashAccount.setMsisdn(jSONObject.getString("msisdn"));
        }
        if (jSONObject.has("token")) {
            eCashCredentials.setToken(jSONObject.getString("token"));
        }
        return result;
    }
}
