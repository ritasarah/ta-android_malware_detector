package com.catfiz.ecash.api;

import com.catfiz.ecash.ECash;
import com.catfiz.ecash.model.ECashTransfer;
import com.catfiz.service.FizzlinkDataStorage;
import com.catfiz.service.FriendListDataStorage;
import java.util.ArrayList;
import java.util.List;
import org.apache.http.message.BasicNameValuePair;
import org.json.JSONObject;

public class TransferPayment extends ApiBase {
    private String mSecureOtp = null;
    private String mSecurePin = null;
    private ECashTransfer mTransfer = null;

    public TransferPayment(ECashTransfer eCashTransfer, String str, String str2) {
        this.mTransfer = eCashTransfer;
        this.mSecurePin = str;
        this.mSecureOtp = str2;
    }

    public List generateRequest() {
        List arrayList = new ArrayList();
        arrayList.add(new BasicNameValuePair("msisdn", ECash.getAccount().getMsisdn()));
        arrayList.add(new BasicNameValuePair("toMember", this.mTransfer.getReceiverMsisdn()));
        arrayList.add(new BasicNameValuePair("amount", String.valueOf(this.mTransfer.getAmount())));
        arrayList.add(new BasicNameValuePair(FizzlinkDataStorage.DESCRIPTION, this.mTransfer.getDescription()));
        arrayList.add(new BasicNameValuePair("token", ECash.getAccount().getCredentials().getToken()));
        arrayList.add(new BasicNameValuePair("credentials", this.mSecurePin));
        if (this.mTransfer.isNeedOtp() && this.mSecureOtp != null) {
            arrayList.add(new BasicNameValuePair("otp", this.mSecureOtp));
        }
        return arrayList;
    }

    public String getUrl() {
        return ApiUrl.getUrl(Operation.TRANSFER_MEMBER_PAYMENT);
    }

    public void onPostResponse(Result result) {
    }

    public Result parseResponse(String str) {
        Result result = new Result();
        ECashTransfer eCashTransfer = this.mTransfer;
        result.setResultData(eCashTransfer);
        JSONObject jSONObject = new JSONObject(str);
        if (jSONObject.has(FriendListDataStorage.STATUS)) {
            result.setStatus(jSONObject.getString(FriendListDataStorage.STATUS));
            result.setStatusCode(ResponseStatus.getResponseCode(jSONObject.getString(FriendListDataStorage.STATUS)));
        }
        if (jSONObject.has("toAccount")) {
            eCashTransfer.setReceiverMsisdn(jSONObject.getString("toAccount"));
        }
        if (jSONObject.has("amount")) {
            eCashTransfer.setAmount((int) Float.parseFloat(jSONObject.getString("amount")));
        }
        if (jSONObject.has("transactionNumber")) {
            eCashTransfer.setTransactionNumber(jSONObject.getString("transactionNumber"));
        }
        return result;
    }
}
