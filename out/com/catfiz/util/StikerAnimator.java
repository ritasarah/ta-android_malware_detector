package com.catfiz.util;

import android.graphics.Bitmap;
import android.graphics.Bitmap.Config;
import android.graphics.Canvas;
import android.graphics.Paint;
import android.graphics.PorterDuff.Mode;
import android.graphics.PorterDuffXfermode;
import android.widget.ImageView;
import java.util.Map;

public class StikerAnimator implements Runnable {
    public static final String TAG = "StikerAnimator";
    private Map mAnimatorMap = null;
    private int mClipHeight = 0;
    private int mClipWidth = 0;
    private int mDuration = 20;
    private int mFrameNumber = 0;
    private Bitmap mImage = null;
    private ImageView mImageView = null;
    private String mKey = null;

    public StikerAnimator(ImageView imageView, Bitmap bitmap, int i, Map map, String str, int i2, int i3) {
        this.mImage = bitmap;
        this.mImageView = imageView;
        this.mFrameNumber = i;
        this.mAnimatorMap = map;
        this.mKey = str;
        this.mClipWidth = i2;
        this.mClipHeight = i3;
    }

    private Bitmap getcropedBitmapFrame(int i) {
        int i2 = this.mClipHeight * 1;
        int i3 = this.mClipWidth;
        int i4 = this.mClipHeight + (1 * this.mClipHeight);
        Bitmap createBitmap = Bitmap.createBitmap(this.mClipWidth, this.mClipHeight, Config.ARGB_8888);
        Paint paint = new Paint();
        paint.setXfermode(new PorterDuffXfermode(Mode.CLEAR));
        Canvas canvas = new Canvas(createBitmap);
        canvas.drawBitmap(this.mImage, 0.0f, 0.0f, null);
        canvas.drawRect((float) 0, (float) i2, (float) i3, (float) i4, paint);
        return createBitmap;
    }

    public void run() {
        int i = 0;
        while (i <= this.mDuration) {
            int i2 = i % this.mFrameNumber;
            Bitmap bitmap = getcropedBitmapFrame(i2);
            String str = (String) this.mImageView.getTag();
            Log.d(TAG, "tag=" + str + " key=" + this.mKey + " frame=" + i2 + " tick=" + i);
            if (this.mImageView != null && str.compareTo(this.mKey) == 0) {
                this.mImageView.setImageBitmap(bitmap);
            }
            int i3 = i + 1;
            try {
                Thread.sleep(500);
                i = i3;
            } catch (InterruptedException e) {
            }
        }
        this.mAnimatorMap.remove(this.mKey);
    }
}
