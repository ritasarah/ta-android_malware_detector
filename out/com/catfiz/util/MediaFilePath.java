package com.catfiz.util;

import android.app.Activity;
import android.database.Cursor;
import android.net.Uri;
import android.net.Uri.Builder;

public class MediaFilePath {
    public static String getPath(Activity activity, Uri uri) {
        String path = FileUtils.getPath(activity, uri);
        if (path != null) {
            return path;
        }
        path = uri.getPath();
        int indexOf = path.indexOf("external/");
        int indexOf2 = path.indexOf("/ACTUAL");
        if (!(indexOf == -1 || indexOf2 == -1)) {
            path = path.substring(indexOf, indexOf2);
            Builder buildUpon = uri.buildUpon();
            buildUpon.path(path);
            buildUpon.authority("media");
            Cursor managedQuery = activity.managedQuery(buildUpon.build(), new String[]{"_data"}, null, null, null);
            if (managedQuery != null) {
                indexOf = managedQuery.getColumnIndexOrThrow("_data");
                managedQuery.moveToFirst();
                path = managedQuery.getString(indexOf);
                if (path != null) {
                    return path;
                }
            }
        }
        return uri.getPath();
    }
}
