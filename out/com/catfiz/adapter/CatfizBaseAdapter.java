package com.catfiz.adapter;

import android.widget.BaseAdapter;
import com.catfiz.util.Log;

public abstract class CatfizBaseAdapter extends BaseAdapter {
    private static final String TAG = "CatfizBaseAdapter";
    private int mCurrentCount = 0;
    private int mPendingUpdate = 0;
    private boolean mVisible = true;

    private boolean updateCountAndCheck() {
        int count = getCount();
        if (this.mCurrentCount != count) {
            this.mCurrentCount = count;
            Log.d(TAG, "--- updateCountAndCheck: notify Anchestor once to update their count value=" + count);
            super.notifyDataSetChanged();
            return true;
        }
        Log.d(TAG, "--- updateCountAndCheck: set count value=" + count);
        this.mCurrentCount = count;
        return false;
    }

    public void addPendingUpdate() {
        this.mPendingUpdate++;
    }

    public boolean getAdapterVisibility() {
        return this.mVisible;
    }

    public boolean hasPendingUpdate() {
        return this.mPendingUpdate > 0;
    }

    public void notifyDataSetChanged() {
        if (!updateCountAndCheck()) {
            if (this.mVisible) {
                Log.d(TAG, "--- notifyDataSetChanged ---");
                super.notifyDataSetChanged();
                return;
            }
            Log.d(TAG, "--- PENDING notifyDataSetChanged: WE ARE NOT VISIBLE ---");
            this.mPendingUpdate++;
        }
    }

    public void notifyDataSetChangedOnPause() {
        Log.d(TAG, "--- notifyDataSetChangedOnPause ---");
        super.notifyDataSetChanged();
    }

    public void setAdapterVisibility(boolean z) {
        Log.d(TAG, "--- SET VISIBILITY: " + z);
        this.mVisible = z;
        if (this.mVisible && this.mPendingUpdate > 0) {
            this.mCurrentCount = getCount();
            this.mPendingUpdate = 0;
            super.notifyDataSetChanged();
        } else if (this.mVisible && this.mCurrentCount != getCount()) {
            Log.d(TAG, "--- VISIBLE BUT COUNT IS NOT VALIDATED: call notifyDataSetChanged ---");
            this.mCurrentCount = getCount();
            super.notifyDataSetChanged();
        }
    }
}
