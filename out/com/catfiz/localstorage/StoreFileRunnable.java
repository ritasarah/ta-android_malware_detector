package com.catfiz.localstorage;

import android.support.v4.view.accessibility.AccessibilityNodeInfoCompat;
import com.catfiz.service.CatfishService;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.OutputStream;

public class StoreFileRunnable implements Runnable {
    private File mDataFile = null;
    private String mDataKey = null;

    public StoreFileRunnable(File file, String str) {
        this.mDataFile = file;
        this.mDataKey = str;
    }

    protected CatfishService getCatfishService() {
        return CatfishService.getServiceInstance();
    }

    public void run() {
        ChunkStorage chunkStorage = new ChunkStorage(getCatfishService());
        try {
            FileInputStream fileInputStream = new FileInputStream(this.mDataFile);
            OutputStream fileOutputStream = new FileOutputStream(new File(LocalStorageWorker.FILESTORAGE_ROOT_PATH, this.mDataKey));
            byte[] bArr = new byte[AccessibilityNodeInfoCompat.ACTION_NEXT_HTML_ELEMENT];
            while (true) {
                int read = fileInputStream.read(bArr);
                if (read != -1) {
                    fileOutputStream.write(bArr, 0, read);
                } else {
                    fileOutputStream.flush();
                    fileOutputStream.close();
                    fileInputStream.close();
                    return;
                }
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
