package com.catfiz.service.uidbexec;

import com.catfiz.service.CatfishDataStorage;
import com.catfiz.service.CatfishMessageObject;
import com.catfiz.service.CatfishRESTAPI.MessageType;
import com.catfiz.service.CatfishService;
import com.catfiz.service.CatfishUIBinder.DatabaseRequestOP;
import com.catfiz.service.ICatfishClientInterface;
import com.catfiz.service.ICatfishUIBinder;
import com.catfiz.service.uiresponse.CUIDatabaseResponse;
import com.catfiz.util.Log;

public class CUIMessageDeliveryStatusUpdaterWithConvkey extends CUIDatabaseExecutorBase {
    private static final String TAG = "CUIMessageDeliveryStatusUpdaterWithConvkey";

    public CUIMessageDeliveryStatusUpdaterWithConvkey(ICatfishUIBinder iCatfishUIBinder, ICatfishClientInterface iCatfishClientInterface, CatfishMessageObject catfishMessageObject) {
        super(iCatfishUIBinder, iCatfishClientInterface, catfishMessageObject, DatabaseRequestOP.UNKNOWN);
        Log.d(TAG, "Conv Key: " + this.mMessage.conversation_key);
    }

    public void run() {
        CatfishDataStorage catfishDataStorage = new CatfishDataStorage(getCatfishService());
        this.mMessage.rcvtimestamp = this.mMessage.sequence;
        if (!catfishDataStorage.updateMessageSentStatusWithConvkey(this.mMessage)) {
            Log.d(TAG, "Message Delivery Status set to: SENT: FAIL: Conv key:" + this.mMessage.conversation_key);
        } else if (this.mMessage.messagetype == MessageType.NIC_MESSAGE) {
            r0 = catfishDataStorage.getNicMessageList();
            r2 = this.mIfclient;
            getCatfishService();
            postResponse(new CUIDatabaseResponse(r2, CatfishService.GET_NIC_MESSAGE, r0));
        } else {
            r0 = catfishDataStorage.getChatConversation(this.mMessage);
            r2 = this.mIfclient;
            getCatfishService();
            postResponse(new CUIDatabaseResponse(r2, CatfishService.GET_CONVERSATION_KEY, r0));
        }
    }
}
