package com.catfiz.service.uidbexec;

import com.catfiz.service.CatfishDataStorage;
import com.catfiz.service.CatfishMessageObject;
import com.catfiz.service.CatfishUIBinder.DatabaseRequestOP;
import com.catfiz.service.FriendListDataStorage;
import com.catfiz.service.ICatfishClientInterface;
import com.catfiz.service.ICatfishUIBinder;
import com.catfiz.service.uiresponse.CUIBCASTGenericResponse;

public class CUIBCASTDeliveryStatusUpdater extends CUIDatabaseExecutorBase {
    public CUIBCASTDeliveryStatusUpdater(ICatfishUIBinder iCatfishUIBinder, ICatfishClientInterface iCatfishClientInterface, CatfishMessageObject catfishMessageObject) {
        super(iCatfishUIBinder, iCatfishClientInterface, catfishMessageObject, DatabaseRequestOP.UNKNOWN);
    }

    public void run() {
        CatfishDataStorage catfishDataStorage = new CatfishDataStorage(getCatfishService());
        FriendListDataStorage friendListDataStorage = new FriendListDataStorage(getCatfishService());
        this.mMessage.rcvtimestamp = this.mMessage.sequence;
        for (String lastMessageStatus : this.mMessage.recipients) {
            friendListDataStorage.setLastMessageStatus(true, lastMessageStatus, this.mMessage.deliverystatus.ordinal());
        }
        if (catfishDataStorage.updateBCASTSentStatus(this.mMessage)) {
            postResponse(new CUIBCASTGenericResponse(this.mIfclient));
        }
    }
}
