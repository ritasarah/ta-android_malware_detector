package com.catfiz.service.uidbexec;

import android.database.Cursor;
import com.catfiz.service.CatfishDataStorage;
import com.catfiz.service.CatfishMessageObject;
import com.catfiz.service.CatfishService;
import com.catfiz.service.CatfishUIBinder.DatabaseRequestOP;
import com.catfiz.service.ICatfishClientInterface;
import com.catfiz.service.uiresponse.CUIDatabaseResponse;

public class CUIDBGetChatConvExecutor extends CUIDatabaseExecutorBase {
    private static final String TAG = "CUIDBGetChatConvExecutor";

    public CUIDBGetChatConvExecutor(ICatfishClientInterface iCatfishClientInterface, CatfishMessageObject catfishMessageObject) {
        super(null, iCatfishClientInterface, catfishMessageObject, DatabaseRequestOP.GET_CONVERSATION);
    }

    public void run() {
        Cursor chatConversation = new CatfishDataStorage(getCatfishService()).getChatConversation(this.mMessage);
        if (!(this.mIfclient == null || this.mIfclient.isFinish())) {
            Object valueOf;
            ICatfishClientInterface iCatfishClientInterface;
            if (this.mMessage.is_need_count) {
                valueOf = Integer.valueOf(chatConversation.getCount());
                iCatfishClientInterface = this.mIfclient;
                getCatfishService();
                postResponse(new CUIDatabaseResponse(iCatfishClientInterface, CatfishService.GET_CONVERSATION_COUNT_KEY, valueOf));
            } else {
                valueOf = this.mIfclient.transfromDBCursor(this.mOperation, chatConversation, 0);
                iCatfishClientInterface = this.mIfclient;
                getCatfishService();
                postResponse(new CUIDatabaseResponse(iCatfishClientInterface, CatfishService.GET_CONVERSATION_KEY, valueOf));
            }
        }
        if (chatConversation != null) {
            chatConversation.close();
        }
    }
}
