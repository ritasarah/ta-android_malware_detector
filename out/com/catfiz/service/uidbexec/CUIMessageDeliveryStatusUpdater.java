package com.catfiz.service.uidbexec;

import android.database.Cursor;
import com.catfiz.service.CatfishDataStorage;
import com.catfiz.service.CatfishMessageObject;
import com.catfiz.service.CatfishService;
import com.catfiz.service.CatfishUIBinder.DatabaseRequestOP;
import com.catfiz.service.FriendListDataStorage;
import com.catfiz.service.ICatfishClientInterface;
import com.catfiz.service.ICatfishUIBinder;
import com.catfiz.service.uiresponse.CUIDatabaseResponse;

public class CUIMessageDeliveryStatusUpdater extends CUIDatabaseExecutorBase {
    public CUIMessageDeliveryStatusUpdater(ICatfishUIBinder iCatfishUIBinder, ICatfishClientInterface iCatfishClientInterface, CatfishMessageObject catfishMessageObject) {
        super(iCatfishUIBinder, iCatfishClientInterface, catfishMessageObject, DatabaseRequestOP.UNKNOWN);
    }

    public void run() {
        CatfishDataStorage catfishDataStorage = new CatfishDataStorage(getCatfishService());
        this.mMessage.rcvtimestamp = this.mMessage.sequence;
        this.mMessage.conversation_key = this.mMessage.userpin + ":" + this.mMessage.recipient;
        new FriendListDataStorage(getCatfishService()).setLastMessageStatus(true, this.mMessage.recipient, this.mMessage.deliverystatus.ordinal());
        if (catfishDataStorage.updateMessageSentStatus(this.mMessage)) {
            Cursor chatConversation = catfishDataStorage.getChatConversation(this.mMessage);
            ICatfishClientInterface iCatfishClientInterface = this.mIfclient;
            getCatfishService();
            postResponse(new CUIDatabaseResponse(iCatfishClientInterface, CatfishService.GET_CONVERSATION_KEY, chatConversation));
        }
    }
}
