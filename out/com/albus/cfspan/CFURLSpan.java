package com.albus.cfspan;

import android.content.Context;
import android.content.Intent;
import android.net.Uri;
import android.os.Bundle;
import android.os.Parcel;
import android.support.v7.app.ActionBarActivity;
import android.text.style.URLSpan;
import android.view.View;
import com.albus.activity.FizzlinkFileViewerActivity;
import com.albus.dialog.NicProfileDialog;
import com.albus.util.AlbusModelObject;
import com.catfiz.service.CatfishRESTAPI;
import com.catfiz.service.ServerMessageDataStorage;
import com.catfiz.svcpersistent.TaskDataStorage;
import com.catfiz.util.Log;

public class CFURLSpan extends URLSpan {
    public static final String CATFIZ_DOMAIN = "catfiz.com";
    public static final String CATFIZ_DOWNLOAD_PATH = "/download";
    public static final String CATFIZ_SCHEME = "catfiz";
    public static final String CATFIZ_WEB_DOMAIN = "www.catfiz.com";
    public static final String FIZZLINK_DOMAIN = "fizzlink.catfiz.com";
    public static final String FL_DOMAIN = "fl.catfiz.com";
    public static final String HTTPS_SCHEME = "https";
    public static final String HTTP_SCHEME = "http";
    public static final String NIC_DOMAIN = "nic.catfiz.com";
    public static final String NIC_FRAGMENT_TAG = "NIC";
    public static final String NIC_SCHEME = "nic:";
    public static final String TAG = "CFURLSpan";
    public int mEnd = 0;
    public int mStart = 0;

    public CFURLSpan(Parcel parcel) {
        super(parcel);
    }

    public CFURLSpan(URLSpan uRLSpan) {
        super(uRLSpan.getURL());
        if (uRLSpan instanceof CFURLSpan) {
            this.mStart = ((CFURLSpan) uRLSpan).mStart;
            this.mEnd = ((CFURLSpan) uRLSpan).mEnd;
        }
    }

    public CFURLSpan(String str) {
        super(str);
    }

    public CFURLSpan(String str, int i, int i2) {
        super(str);
        this.mStart = i;
        this.mEnd = i2;
    }

    private void showNicProfile(Context context, String str) {
        if (context instanceof ActionBarActivity) {
            String str2 = str.split(":")[1];
            Bundle bundle = new Bundle();
            bundle.putString(CatfishRESTAPI.CFCOMPACT_STICKERID, str2);
            NicProfileDialog.newInstance(bundle).show(((ActionBarActivity) context).getSupportFragmentManager(), NIC_FRAGMENT_TAG);
        }
    }

    public void onClick(View view) {
        Context context = view.getContext();
        String url = getURL();
        Uri parse = Uri.parse(url);
        String scheme = parse.getScheme();
        Log.d(TAG, "FIZZLINK: " + parse.getLastPathSegment());
        if (url.startsWith(NIC_SCHEME)) {
            showNicProfile(view.getContext(), url);
        } else if (!scheme.equals(CATFIZ_SCHEME)) {
            if (scheme.equals(HTTP_SCHEME) || scheme.equals(HTTPS_SCHEME)) {
                if (parse.getHost().equals(NIC_DOMAIN)) {
                    showNicProfile(view.getContext(), NIC_SCHEME + parse.getLastPathSegment());
                    return;
                }
                if (parse.getHost().equals(CATFIZ_WEB_DOMAIN) || parse.getHost().equals(CATFIZ_DOMAIN)) {
                    url = parse.getPath();
                    if (url != null && url.equals(CATFIZ_DOWNLOAD_PATH)) {
                        r1 = new Intent("android.intent.action.VIEW", parse);
                        r1.putExtra("com.android.browser.application_id", context.getPackageName());
                        context.startActivity(r1);
                        return;
                    }
                }
                if (parse.getHost().equals(FL_DOMAIN) || parse.getHost().equals(FIZZLINK_DOMAIN)) {
                    r1 = new Intent(context, FizzlinkFileViewerActivity.class);
                    r1.putExtra(ServerMessageDataStorage.SLINK, parse.getLastPathSegment());
                    r1.putExtra(TaskDataStorage.FILE_PATH, "");
                    r1.putExtra(AlbusModelObject.INTENT_ROOM, FL_DOMAIN);
                    context.startActivity(r1);
                    return;
                }
            }
            r1 = new Intent("android.intent.action.VIEW", parse);
            r1.putExtra("com.android.browser.application_id", context.getPackageName());
            context.startActivity(r1);
        } else if (parse.getHost().equals(FL_DOMAIN) || parse.getHost().equals(FIZZLINK_DOMAIN)) {
            r1 = new Intent(context, FizzlinkFileViewerActivity.class);
            r1.putExtra(ServerMessageDataStorage.SLINK, parse.getLastPathSegment());
            r1.putExtra(TaskDataStorage.FILE_PATH, "");
            r1.putExtra(AlbusModelObject.INTENT_ROOM, FL_DOMAIN);
            context.startActivity(r1);
        } else {
            r1 = new Intent("android.intent.action.VIEW", parse);
            r1.putExtra("com.android.browser.application_id", context.getPackageName());
            context.startActivity(r1);
        }
    }
}
