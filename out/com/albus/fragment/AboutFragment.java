package com.albus.fragment;

import android.content.ActivityNotFoundException;
import android.content.Intent;
import android.net.Uri;
import android.os.Bundle;
import android.support.v4.app.Fragment;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.MenuInflater;
import android.view.MenuItem;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.TextView;
import com.albus.dialog.AlbusDialog;
import com.albus.dialog.DialogUI;
import com.albus.util.AlbusModelObject;
import com.catfiz.R;
import com.catfiz.service.CatfishService;

public class AboutFragment extends Fragment {
    private static final String TAG = "AboutFragment";
    private ImageView ivApp = null;
    private TextView tvTitle = null;
    private TextView tvVersion = null;

    public static AboutFragment newInstance() {
        return new AboutFragment();
    }

    public void onCreateOptionsMenu(Menu menu, MenuInflater menuInflater) {
        super.onCreateOptionsMenu(menu, menuInflater);
        menuInflater.inflate(R.menu.actionbar_about, menu);
    }

    public View onCreateView(LayoutInflater layoutInflater, ViewGroup viewGroup, Bundle bundle) {
        View inflate = layoutInflater.inflate(R.layout.fragment_about, viewGroup, false);
        ((TextView) inflate.findViewById(R.id.catfiz_app_version)).setText(getResources().getString(R.string.app_version) + "." + CatfishService.getCatfishVersion());
        this.ivApp = (ImageView) inflate.findViewById(R.id.iv_app);
        this.tvVersion = (TextView) inflate.findViewById(R.id.catfiz_app_version);
        this.tvTitle = (TextView) inflate.findViewById(R.id.tv_title);
        this.ivApp.setOnClickListener(new OnClickListener() {
            public void onClick(View view) {
                AboutFragment.this.openCatfizSite();
            }
        });
        this.tvVersion.setOnClickListener(new OnClickListener() {
            public void onClick(View view) {
                AboutFragment.this.openCatfizSite();
            }
        });
        this.tvTitle.setOnClickListener(new OnClickListener() {
            public void onClick(View view) {
                AboutFragment.this.openCatfizSite();
            }
        });
        ((Button) inflate.findViewById(R.id.btn_rate)).setOnClickListener(new OnClickListener() {
            public void onClick(View view) {
                Intent intent = new Intent("android.intent.action.VIEW", Uri.parse("market://details?id=com.catfiz"));
                intent.addFlags(1208483840);
                try {
                    AboutFragment.this.startActivity(intent);
                } catch (ActivityNotFoundException e) {
                    AboutFragment.this.startActivity(new Intent("android.intent.action.VIEW", Uri.parse("http://play.google.com/store/apps/details?id=com.catfiz")));
                }
            }
        });
        setHasOptionsMenu(true);
        return inflate;
    }

    public boolean onOptionsItemSelected(MenuItem menuItem) {
        switch (menuItem.getItemId()) {
            case R.id.contributors:
                Bundle bundle = new Bundle();
                bundle.putInt(AlbusModelObject.DIALOG, 58);
                AlbusDialog.showDialog(58, new DialogUI().getDialogInterface(), getActivity(), bundle, getActivity().getSupportFragmentManager());
                break;
            case R.id.feedback:
                Intent intent = new Intent("android.intent.action.SEND");
                intent.setType("text/email");
                intent.putExtra("android.intent.extra.EMAIL", new String[]{getString(R.string.support_email_address)});
                intent.putExtra("android.intent.extra.SUBJECT", getString(R.string.feedback_subject));
                intent.putExtra("android.intent.extra.TEXT", getString(R.string.feedback_text));
                startActivity(Intent.createChooser(intent, "Send Feedback"));
                return true;
        }
        return super.onOptionsItemSelected(menuItem);
    }

    protected void openCatfizSite() {
        Intent intent = new Intent("android.intent.action.VIEW");
        intent.setData(Uri.parse("http://www.catfiz.com"));
        startActivity(intent);
    }
}
