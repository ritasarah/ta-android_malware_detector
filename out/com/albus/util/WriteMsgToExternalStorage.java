package com.albus.util;

import android.content.Context;
import com.catfiz.R;
import com.catfiz.media.StorageDir;
import com.catfiz.model.Message;
import com.catfiz.service.CatfishService;
import com.catfiz.util.Log;
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.util.List;

public class WriteMsgToExternalStorage {
    private static final String SENT = "Sent";
    private static final String VOICE_MESSAGE = "Voice Message";
    private static final String VOICE_MESSAGE_SENT = "Voice Message Sent";

    public static String generateNote(Context context, String str, List list, String str2, boolean z) {
        File file;
        if (z) {
            try {
                file = new File(StorageDir.getGroupChatDir(5));
            } catch (IOException e) {
                e.printStackTrace();
                Log.d("Write", e.getMessage());
                return context.getString(R.string.conv_saved_failed);
            }
        }
        file = new File(StorageDir.getPrivateChatDir(5));
        if (!file.exists()) {
            file.mkdirs();
        }
        FileWriter fileWriter = new FileWriter(new File(file, str + ".txt"));
        if (list.size() > 0) {
            for (Message message : list) {
                if (message.getSender().getId().equals(CatfishService.getUserPIN())) {
                    fileWriter.write(message.getSender().getName() + " : " + getMsgText(message));
                } else {
                    fileWriter.write(str2 + " : " + getMsgText(message));
                }
                fileWriter.write(System.lineSeparator());
            }
        }
        fileWriter.flush();
        fileWriter.close();
        return context.getString(R.string.conv_saved);
    }

    private static String getMsgText(Message message) {
        String str = "";
        String substring;
        if (message.getVoiceFilePath().isEmpty()) {
            if (message.getImageFilePath().isEmpty() && message.getImageThumbURI().isEmpty()) {
                if (message.getDataFilePath().isEmpty()) {
                    return str + message.getText();
                }
                if (!message.getText().endsWith(SENT)) {
                    return !message.getText().equals("") ? str + message.getText() : str + "File Received";
                } else {
                    substring = message.getText().substring(0, message.getText().length() - 4);
                    return !substring.equals("") ? str + substring + " --> File Sent" : str + "File Sent";
                }
            } else if (!message.getText().endsWith(SENT)) {
                return !message.getText().equals("") ? str + message.getText() : str + "Image Received";
            } else {
                substring = message.getText().substring(0, message.getText().length() - SENT.length());
                return !substring.equals("") ? str + substring + " --> Image Sent" : str + "Image Sent";
            }
        } else if (!message.getText().endsWith(SENT)) {
            return !message.getText().substring(0, message.getText().length() - VOICE_MESSAGE.length()).equals("") ? str + message.getText() + " --> Voice Message Received" : str + "Voice Message Received";
        } else {
            substring = message.getText().substring(0, message.getText().length() - (VOICE_MESSAGE_SENT.length() + 1));
            return !substring.equals("") ? str + substring + " --> Voice Message Sent" : str + VOICE_MESSAGE_SENT;
        }
    }
}
