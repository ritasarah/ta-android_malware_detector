package com.albus.view;

import android.content.Context;
import android.graphics.BitmapFactory;
import android.graphics.BitmapFactory.Options;
import android.graphics.drawable.ColorDrawable;
import android.graphics.drawable.Drawable;
import android.util.AttributeSet;
import android.view.LayoutInflater;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.View.OnLongClickListener;
import android.widget.FrameLayout;
import android.widget.ImageButton;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.LinearLayout.LayoutParams;
import android.widget.ProgressBar;
import android.widget.RelativeLayout;
import android.widget.SeekBar;
import android.widget.TextView;
import com.albus.activity.ChatGroupConvActivity;
import com.albus.cfspan.CFLinkify;
import com.albus.imagespan.SmiledText;
import com.albus.keys.CacheKeys;
import com.albus.media.ThumbnailLoader;
import com.albus.media.UserPhotoLoader;
import com.albus.util.AlbusAudioPlayer;
import com.albus.util.AlbusAudioPlayer.onAudioStateChange;
import com.albus.util.AlbusUtils;
import com.albus.util.LongMessageWorker;
import com.albus.util.QuoteUtils;
import com.catfiz.R;
import com.catfiz.gif.AnimationListener;
import com.catfiz.gif.GifDrawable;
import com.catfiz.media.CatfishPhotoStorage;
import com.catfiz.model.FileMetaInfo;
import com.catfiz.model.Fizzlink;
import com.catfiz.model.Message;
import com.catfiz.model.Quote;
import com.catfiz.model.User;
import com.catfiz.service.CatfishRESTAPI.MessageDeliveryStatus;
import com.catfiz.service.CatfishRESTAPI.MessageType;
import com.catfiz.service.FriendListDataStorage;
import com.catfiz.service.ServerMessageDataStorage;
import com.catfiz.svcpersistent.TaskDataStorage;
import com.catfiz.util.Log;
import com.catfiz.util.Utils;
import java.io.File;
import java.io.IOException;
import java.lang.ref.WeakReference;
import java.util.HashMap;
import java.util.List;
import java.util.Locale;
import org.apache.commons.logging.impl.SimpleLog;
import org.apache.http.conn.routing.HttpRouteDirector;
import org.apache.http.protocol.HTTP;

public class ChatItemRightView extends LinearLayout implements OnClickListener {
    private static int BUBBLE_IMAGE_HEIGHT_LANDSCAPE = 0;
    private static int BUBBLE_IMAGE_HEIGHT_PORTRAIT = 0;
    private static int BUBBLE_IMAGE_WIDTH_NORMAL = 0;
    private static final String TAG = "ChatItemRightView";
    private ImageView mCancelDownloadHelper = null;
    private int mChatViewType = 1;
    private Context mContext = null;
    private ImageView mFileCancel = null;
    private ImageView mFileRetry = null;
    private FrameLayout mFmPicLayer = null;
    private ImageButton mIbVoiceCancel = null;
    private ImageButton mIbVoicePlayer = null;
    private OnItemRightClickListener mItemClickListener = null;
    private OnItemRightLongClickListener mItemLongClickListener = null;
    private LinearLayout mItemRight = null;
    private ImageView mIvFizzIcon;
    private ImageView mIvPlayVideoPic = null;
    private ImageView mIvStatus = null;
    private ImageView mIvThumbFile = null;
    private ImageView mIvThumbPic = null;
    private LinearLayout mLlAttachContact = null;
    private LinearLayout mLlAttachContainer = null;
    private LinearLayout mLlAttachFile = null;
    private LinearLayout mLlAttachPic = null;
    private LinearLayout mLlBgItemMsg = null;
    private LinearLayout mLlFizzlinkContainer;
    private LinearLayout mLlLike = null;
    private LinearLayout mLlQuote = null;
    private LongMessageWorker mLongMessageWorker = null;
    private String mMessageKey = null;
    private Message mMsg = null;
    OnLongClickListener mOnLongClick = new OnLongClickListener() {
        public boolean onLongClick(View view) {
            ChatItemRightView.this.mItemLongClickListener.onItemLongClicked(view);
            return false;
        }
    };
    private ProgressBar mProgressBarFile = null;
    private ProgressBar mProgressBarPic = null;
    private ProgressBar mProgressBarVoice = null;
    private CircleImageView mRivContactPicBottomLeft = null;
    private CircleImageView mRivContactPicBottomRight = null;
    private CircleImageView mRivContactPicTopLeft = null;
    private CircleImageView mRivContactPicTopRight = null;
    private CircleImageView mRivSingleContactPic = null;
    private RelativeLayout mRlAttachMultiContact = null;
    private RelativeLayout mRlAttachPic = null;
    private RelativeLayout mRlAttachVoice = null;
    private String mRoomName = null;
    private SeekBar mSbPlayback = null;
    private ThumbnailLoader mThumbnailLoader = null;
    private TextView mTvCancel = null;
    private TextView mTvChat = null;
    private TextView mTvContactMsg = null;
    private TextView mTvContactName = null;
    private TextView mTvDay = null;
    private TextView mTvDuration = null;
    private TextView mTvFileName = null;
    private TextView mTvFileSize = null;
    private TextView mTvFizzDesc;
    private TextView mTvFizzTitle;
    private TextView mTvLikeCount = null;
    private TextView mTvName = null;
    private TextView mTvProgressFile;
    private TextView mTvProgressPic = null;
    private TextView mTvQuote = null;
    private TextView mTvQuoteName = null;
    private TextView mTvReadMore = null;
    private TextView mTvRetry = null;
    private UserPhotoLoader mUserPhotoLoader = null;
    private ChatItemStreamView mVideoPlayer = null;
    private boolean mbFitChatToThumbnail = false;

    public interface OnItemRightLongClickListener {
        void onItemLongClicked(View view);
    }

    public interface OnItemRightClickListener {
        void onAttachCancelClicked(Message message);

        void onAttachFileClicked(Message message);

        void onAttachPicClicked(Message message);

        void onFizzlinkClicked(Message message);

        void onItemChatClicked(Message message);

        void onProfilePicClicked(Message message);

        void onRetryUploadClicked(Message message);
    }

    /* synthetic */ class AnonymousClass3 {
        static final /* synthetic */ int[] $SwitchMap$com$catfiz$service$CatfishRESTAPI$MessageDeliveryStatus = new int[MessageDeliveryStatus.values().length];
        static final /* synthetic */ int[] $SwitchMap$com$catfiz$service$CatfishRESTAPI$MessageType = new int[MessageType.values().length];

        static {
            try {
                $SwitchMap$com$catfiz$service$CatfishRESTAPI$MessageType[MessageType.BCASTMESSAGE.ordinal()] = 1;
            } catch (NoSuchFieldError e) {
            }
            try {
                $SwitchMap$com$catfiz$service$CatfishRESTAPI$MessageType[MessageType.BCASTVOICE.ordinal()] = 2;
            } catch (NoSuchFieldError e2) {
            }
            try {
                $SwitchMap$com$catfiz$service$CatfishRESTAPI$MessageType[MessageType.BCASTCONFERENCE_LONGMESSAGE.ordinal()] = 3;
            } catch (NoSuchFieldError e3) {
            }
            try {
                $SwitchMap$com$catfiz$service$CatfishRESTAPI$MessageType[MessageType.LONG_MESSAGE.ordinal()] = 4;
            } catch (NoSuchFieldError e4) {
            }
            try {
                $SwitchMap$com$catfiz$service$CatfishRESTAPI$MessageDeliveryStatus[MessageDeliveryStatus.BCASTQUEUE.ordinal()] = 1;
            } catch (NoSuchFieldError e5) {
            }
            try {
                $SwitchMap$com$catfiz$service$CatfishRESTAPI$MessageDeliveryStatus[MessageDeliveryStatus.QUEUEING.ordinal()] = 2;
            } catch (NoSuchFieldError e6) {
            }
            try {
                $SwitchMap$com$catfiz$service$CatfishRESTAPI$MessageDeliveryStatus[MessageDeliveryStatus.BCASTFAIL.ordinal()] = 3;
            } catch (NoSuchFieldError e7) {
            }
            try {
                $SwitchMap$com$catfiz$service$CatfishRESTAPI$MessageDeliveryStatus[MessageDeliveryStatus.DROP.ordinal()] = 4;
            } catch (NoSuchFieldError e8) {
            }
            try {
                $SwitchMap$com$catfiz$service$CatfishRESTAPI$MessageDeliveryStatus[MessageDeliveryStatus.READ.ordinal()] = 5;
            } catch (NoSuchFieldError e9) {
            }
            try {
                $SwitchMap$com$catfiz$service$CatfishRESTAPI$MessageDeliveryStatus[MessageDeliveryStatus.DELIVERED.ordinal()] = 6;
            } catch (NoSuchFieldError e10) {
            }
            try {
                $SwitchMap$com$catfiz$service$CatfishRESTAPI$MessageDeliveryStatus[MessageDeliveryStatus.BCASTRECEIVED.ordinal()] = 7;
            } catch (NoSuchFieldError e11) {
            }
            try {
                $SwitchMap$com$catfiz$service$CatfishRESTAPI$MessageDeliveryStatus[MessageDeliveryStatus.SENT.ordinal()] = 8;
            } catch (NoSuchFieldError e12) {
            }
            try {
                $SwitchMap$com$catfiz$service$CatfishRESTAPI$MessageDeliveryStatus[MessageDeliveryStatus.BCASTSENT.ordinal()] = 9;
            } catch (NoSuchFieldError e13) {
            }
        }
    }

    class AnimateGifListener implements AnimationListener {
        private WeakReference mGifDrawableRef = null;
        private int mGifLoopCount = 0;

        public AnimateGifListener(GifDrawable gifDrawable) {
            this.mGifDrawableRef = new WeakReference(gifDrawable);
        }

        public void onAnimationCompleted(int i) {
            Log.d(ChatItemRightView.TAG, "Gif Loop count:" + this.mGifLoopCount);
            this.mGifLoopCount++;
            if (this.mGifLoopCount >= 2 && this.mGifDrawableRef != null) {
                GifDrawable gifDrawable = (GifDrawable) this.mGifDrawableRef.get();
                if (gifDrawable != null) {
                    gifDrawable.stop();
                }
            }
        }
    }

    public ChatItemRightView(Context context) {
        super(context);
    }

    public ChatItemRightView(Context context, AttributeSet attributeSet) {
        super(context, attributeSet);
        this.mContext = context;
        this.mItemRight = (LinearLayout) ((LayoutInflater) context.getSystemService("layout_inflater")).inflate(R.layout.item_chat_view_right, this);
        this.mLlBgItemMsg = (LinearLayout) this.mItemRight.findViewById(R.id.ll_bg_msg);
        this.mTvName = (TextView) this.mItemRight.findViewById(R.id.tv_name);
        this.mIvStatus = (ImageView) this.mItemRight.findViewById(R.id.iv_status);
        this.mTvDay = (TextView) this.mItemRight.findViewById(R.id.tv_day);
        this.mTvChat = (TextView) this.mItemRight.findViewById(R.id.tv_chat);
        this.mTvReadMore = (TextView) this.mItemRight.findViewById(R.id.tv_read_more);
        this.mLlLike = (LinearLayout) this.mItemRight.findViewById(R.id.ll_like_container);
        this.mTvLikeCount = (TextView) this.mItemRight.findViewById(R.id.tv_sum_like);
        this.mLlAttachContact = (LinearLayout) this.mItemRight.findViewById(R.id.ll_attach_contact);
        this.mRivSingleContactPic = (CircleImageView) this.mItemRight.findViewById(R.id.riv_attach_contact_single);
        this.mRlAttachMultiContact = (RelativeLayout) this.mItemRight.findViewById(R.id.ll_attach_multi_contact);
        this.mTvContactName = (TextView) this.mItemRight.findViewById(R.id.tv_attached_contact_name);
        this.mTvContactMsg = (TextView) this.mItemRight.findViewById(R.id.tv_attached_contact_msg);
        this.mRivContactPicTopLeft = (CircleImageView) this.mItemRight.findViewById(R.id.riv_attach_multi_contact_top_left);
        this.mRivContactPicTopRight = (CircleImageView) this.mItemRight.findViewById(R.id.riv_attach_multi_contact_top_right);
        this.mRivContactPicBottomLeft = (CircleImageView) this.mItemRight.findViewById(R.id.riv_attach_multi_contact_bottom_left);
        this.mRivContactPicBottomRight = (CircleImageView) this.mItemRight.findViewById(R.id.riv_attach_multi_contact_bottom_right);
        this.mLlAttachContainer = (LinearLayout) this.mItemRight.findViewById(R.id.ll_attach);
        this.mVideoPlayer = (ChatItemStreamView) this.mItemRight.findViewById(R.id.vp_attach_video);
        this.mLlAttachFile = (LinearLayout) this.mItemRight.findViewById(R.id.ll_attach_file);
        this.mIvThumbFile = (ImageView) this.mItemRight.findViewById(R.id.iv_thumb_attach_file);
        this.mTvFileName = (TextView) this.mItemRight.findViewById(R.id.tv_file_attach_name);
        this.mTvFileSize = (TextView) this.mItemRight.findViewById(R.id.tv_file_attach_size);
        this.mFileCancel = (ImageView) this.mItemRight.findViewById(R.id.iv_attach_file_cancel);
        this.mFileRetry = (ImageView) this.mItemRight.findViewById(R.id.iv_attach_file_retry);
        this.mCancelDownloadHelper = (ImageView) this.mItemRight.findViewById(R.id.iv_attach_download_cancel_helper);
        this.mProgressBarFile = (ProgressBar) this.mItemRight.findViewById(R.id.pb_attach_file);
        this.mTvProgressFile = (TextView) this.mItemRight.findViewById(R.id.tv_progress_file);
        this.mLlAttachPic = (LinearLayout) this.mItemRight.findViewById(R.id.ll_attach_pic);
        this.mRlAttachPic = (RelativeLayout) this.mItemRight.findViewById(R.id.rl_attach_pic);
        this.mIvThumbPic = (ImageView) this.mItemRight.findViewById(R.id.iv_thumb_attach_pic);
        this.mTvCancel = (TextView) this.mItemRight.findViewById(R.id.tv_attach_pic_cancel);
        this.mTvRetry = (TextView) this.mItemRight.findViewById(R.id.tv_attach_pic_retry);
        this.mProgressBarPic = (ProgressBar) this.mItemRight.findViewById(R.id.pb_attach_pic);
        this.mFmPicLayer = (FrameLayout) this.mItemRight.findViewById(R.id.fm_thumb_attach_pic);
        this.mIvPlayVideoPic = (ImageView) this.mItemRight.findViewById(R.id.ib_attach_pic_video_play);
        this.mTvProgressPic = (TextView) this.mItemRight.findViewById(R.id.tv_progress_pic);
        this.mRlAttachVoice = (RelativeLayout) this.mItemRight.findViewById(R.id.rl_attach_voice);
        this.mIbVoicePlayer = (ImageButton) this.mItemRight.findViewById(R.id.ib_play);
        this.mTvDuration = (TextView) this.mItemRight.findViewById(R.id.tv_durations);
        this.mSbPlayback = (SeekBar) this.mItemRight.findViewById(R.id.sb_playback);
        this.mProgressBarVoice = (ProgressBar) this.mItemRight.findViewById(R.id.pb_voice);
        this.mIbVoiceCancel = (ImageButton) this.mItemRight.findViewById(R.id.iv_voice_cancel);
        this.mLlQuote = (LinearLayout) this.mItemRight.findViewById(R.id.ll_quote);
        this.mTvQuoteName = (TextView) this.mItemRight.findViewById(R.id.tv_quote_name);
        this.mTvQuote = (TextView) this.mItemRight.findViewById(R.id.tv_quote);
        this.mLlFizzlinkContainer = (LinearLayout) this.mItemRight.findViewById(R.id.ll_fizzlink);
        this.mIvFizzIcon = (ImageView) this.mItemRight.findViewById(R.id.iv_fizz_icon);
        this.mTvFizzTitle = (TextView) this.mItemRight.findViewById(R.id.tv_fizz_title);
        this.mTvFizzDesc = (TextView) this.mItemRight.findViewById(R.id.tv_fizz_desc);
        this.mTvName.setVisibility(8);
        setOnClickListener(this);
        setOnLongClickListener(this.mOnLongClick);
        this.mIvThumbPic.setOnLongClickListener(this.mOnLongClick);
        this.mLlAttachFile.setOnLongClickListener(this.mOnLongClick);
        this.mLlFizzlinkContainer.setOnLongClickListener(this.mOnLongClick);
        this.mIbVoicePlayer.setOnClickListener(this);
        this.mIbVoiceCancel.setOnClickListener(this);
        this.mFileCancel.setOnClickListener(this);
        this.mTvCancel.setOnClickListener(this);
        this.mFileRetry.setOnClickListener(this);
        this.mTvRetry.setOnClickListener(this);
        this.mIvThumbPic.setOnClickListener(this);
        this.mLlAttachFile.setOnClickListener(this);
        this.mIvPlayVideoPic.setOnClickListener(this);
        this.mSbPlayback.setClickable(false);
        this.mTvReadMore.setOnClickListener(this);
        this.mLlFizzlinkContainer.setOnClickListener(this);
        BUBBLE_IMAGE_WIDTH_NORMAL = (int) context.getResources().getDimension(R.dimen.bubble_thumbnail_dimen_normal);
        BUBBLE_IMAGE_HEIGHT_PORTRAIT = (int) context.getResources().getDimension(R.dimen.bubble_image_height_portrait);
        BUBBLE_IMAGE_HEIGHT_LANDSCAPE = (int) context.getResources().getDimension(R.dimen.bubble_image_height_lansdcape);
    }

    private void deliveryUpdate() {
        switch (AnonymousClass3.$SwitchMap$com$catfiz$service$CatfishRESTAPI$MessageDeliveryStatus[MessageDeliveryStatus.values()[this.mMsg.getDeliveryStatus()].ordinal()]) {
            case e.b /*1*/:
            case e.c /*2*/:
                this.mIvStatus.setImageResource(R.drawable.ic_sending);
                return;
            case HttpRouteDirector.TUNNEL_TARGET /*3*/:
            case HttpRouteDirector.TUNNEL_PROXY /*4*/:
                this.mIvStatus.setImageResource(R.drawable.ic_notsent);
                return;
            case HttpRouteDirector.LAYER_PROTOCOL /*5*/:
                this.mIvStatus.setImageResource(R.drawable.ic_read);
                return;
            case SimpleLog.LOG_LEVEL_FATAL /*6*/:
            case SimpleLog.LOG_LEVEL_OFF /*7*/:
                this.mIvStatus.setImageResource(R.drawable.ic_received);
                return;
            case Utils.FILE_TYPE_INSTALLER /*8*/:
            case HTTP.HT /*9*/:
                switch (AnonymousClass3.$SwitchMap$com$catfiz$service$CatfishRESTAPI$MessageType[MessageType.values()[this.mMsg.getType()].ordinal()]) {
                    case e.b /*1*/:
                    case e.c /*2*/:
                        this.mIvStatus.setImageResource(R.drawable.ic_broadcast);
                        return;
                    default:
                        this.mIvStatus.setImageResource(R.drawable.ic_sent);
                        return;
                }
            default:
                return;
        }
    }

    private void hideAllViewAttach() {
        this.mLlAttachPic.setVisibility(8);
        this.mLlAttachContact.setVisibility(8);
        this.mLlAttachFile.setVisibility(8);
        this.mRlAttachVoice.setVisibility(8);
    }

    private void hideShowTvChat(String str) {
        if (FileMetaInfo.isFileMetaInfoValid(str)) {
            str = FileMetaInfo.metaInfoBuilder(str).getCaption();
        }
        if (str.equals("") || str.isEmpty() || str.equals("\n") || str.equals(" ")) {
            this.mTvChat.setVisibility(8);
            return;
        }
        this.mTvChat.setVisibility(0);
        this.mTvChat.setText(SmiledText.getSmiledText(this.mContext, this.mMessageKey, str, this.mTvChat));
        CFLinkify.addLinks(this.mTvChat, CFLinkify.NIC | 7);
        if (this.mbFitChatToThumbnail) {
            this.mTvChat.setLayoutParams(new LayoutParams(-1, -2));
            return;
        }
        this.mTvChat.setLayoutParams(new LayoutParams(-2, -2));
    }

    private void processAttachedMessage(int i, String str) {
        String str2;
        boolean z = true;
        Log.d(TAG, "processAttachedMessage:" + i + "_" + str);
        int deliveryStatus = this.mMsg.getDeliveryStatus();
        int progressUploaded = this.mMsg.getProgressUploaded();
        Log.d(TAG, "processAttachedMessage progress:" + deliveryStatus + "_" + progressUploaded);
        switch (i) {
            case e.c /*2*/:
                Log.d(TAG, "processAttach - image");
                setViewAttachPhoto(str);
                str2 = "";
                if (!str.contains("file://")) {
                    str = "file://" + str;
                }
                str2 = str.replaceAll(" ", "%20");
                if (this.mThumbnailLoader != null) {
                    this.mThumbnailLoader.loadImage((Object) str2, this.mIvThumbPic, true);
                }
                if (progressUploaded > 100 || progressUploaded <= 0) {
                    if (this.mMsg.isUploadFailed()) {
                        this.mProgressBarPic.setVisibility(8);
                        this.mFmPicLayer.setForeground(new ColorDrawable(R.color.transparent54));
                    } else {
                        this.mProgressBarPic.setVisibility(8);
                        this.mTvCancel.setVisibility(8);
                        this.mTvRetry.setVisibility(8);
                        this.mFmPicLayer.setForeground(null);
                    }
                    this.mProgressBarPic.setVisibility(8);
                    this.mTvProgressPic.setVisibility(8);
                    this.mTvCancel.setVisibility(8);
                    this.mTvRetry.setVisibility(8);
                    this.mFmPicLayer.setForeground(null);
                } else {
                    this.mProgressBarPic.setVisibility(0);
                    this.mProgressBarPic.setProgress(progressUploaded);
                    this.mTvProgressPic.setVisibility(0);
                    this.mTvProgressPic.setText(progressUploaded + "%");
                    this.mTvCancel.setVisibility(0);
                    this.mTvRetry.setVisibility(8);
                    this.mFmPicLayer.setForeground(new ColorDrawable(R.color.transparent54));
                }
                if (!(deliveryStatus == MessageDeliveryStatus.DROP.ordinal() || deliveryStatus == MessageDeliveryStatus.BCASTFAIL.ordinal())) {
                    z = false;
                }
                if (z) {
                    this.mFmPicLayer.setForeground(new ColorDrawable(R.color.transparent54));
                    this.mProgressBarPic.setVisibility(8);
                    this.mTvCancel.setVisibility(8);
                    this.mTvRetry.setVisibility(0);
                    this.mTvDay.setText(this.mContext.getString(R.string.upload_canceled));
                }
                switch (Utils.getFileTypeFromPath(this.mMsg.getDataFilePath())) {
                    case SimpleLog.LOG_LEVEL_FATAL /*6*/:
                        this.mIvPlayVideoPic.setVisibility(0);
                        return;
                    default:
                        this.mIvPlayVideoPic.setVisibility(8);
                        return;
                }
            case HttpRouteDirector.TUNNEL_TARGET /*3*/:
                break;
            case HttpRouteDirector.TUNNEL_PROXY /*4*/:
                Log.d(TAG, "processAttach - file");
                break;
            case HttpRouteDirector.LAYER_PROTOCOL /*5*/:
                Log.d(TAG, "processAttach - voice");
                setViewAttachVoice();
                if (progressUploaded > 100 || progressUploaded <= 0) {
                    this.mSbPlayback.setVisibility(0);
                    this.mIbVoicePlayer.setVisibility(0);
                    this.mProgressBarVoice.setVisibility(8);
                    this.mIbVoiceCancel.setVisibility(8);
                    this.mTvDuration.setVisibility(0);
                    this.mTvDuration.setText(AlbusAudioPlayer.getDurationFromAudioFile(this.mContext, str));
                    this.mIbVoicePlayer.setImageResource(R.drawable.ic_play_dark);
                    this.mSbPlayback.setProgress(0);
                    return;
                }
                this.mSbPlayback.setVisibility(8);
                this.mIbVoicePlayer.setVisibility(8);
                this.mProgressBarVoice.setVisibility(0);
                this.mProgressBarVoice.setIndeterminate(false);
                this.mProgressBarVoice.setProgress(progressUploaded);
                this.mIbVoiceCancel.setVisibility(0);
                this.mTvDuration.setVisibility(0);
                this.mTvDuration.setText(progressUploaded + "%");
                return;
            default:
                return;
        }
        Log.d(TAG, "processAttach - video");
        setViewAttachFileOrVideo();
        updateIconFileThumb(str);
        str2 = this.mMsg.getText();
        CharSequence string = this.mContext.getString(R.string.file_processed);
        Object string2 = this.mContext.getString(R.string.three_dot);
        if (FileMetaInfo.isFileMetaInfoValid(str2)) {
            FileMetaInfo metaInfoBuilder = FileMetaInfo.metaInfoBuilder(str2);
            string = metaInfoBuilder.getFileName();
            string2 = metaInfoBuilder.getFileSize();
        }
        this.mTvFileName.setText(string);
        this.mTvFileSize.setText(string2);
        if (progressUploaded > 100 || progressUploaded <= 0) {
            this.mProgressBarFile.setVisibility(8);
            this.mTvProgressFile.setVisibility(8);
            this.mFileCancel.setVisibility(8);
            this.mFileRetry.setVisibility(8);
            this.mCancelDownloadHelper.setVisibility(8);
        } else {
            this.mProgressBarFile.setVisibility(0);
            this.mTvProgressFile.setVisibility(0);
            this.mProgressBarFile.setProgress(progressUploaded);
            this.mTvProgressFile.setText(progressUploaded + "%");
            this.mCancelDownloadHelper.setVisibility(4);
            this.mFileCancel.setVisibility(0);
        }
        switch (AnonymousClass3.$SwitchMap$com$catfiz$service$CatfishRESTAPI$MessageDeliveryStatus[MessageDeliveryStatus.values()[this.mMsg.getDeliveryStatus()].ordinal()]) {
            case e.b /*1*/:
            case e.c /*2*/:
                return;
            case HttpRouteDirector.TUNNEL_TARGET /*3*/:
            case HttpRouteDirector.TUNNEL_PROXY /*4*/:
                this.mProgressBarFile.setVisibility(8);
                this.mTvProgressFile.setVisibility(8);
                this.mFileCancel.setVisibility(8);
                this.mFileRetry.setVisibility(0);
                this.mCancelDownloadHelper.setVisibility(4);
                this.mTvFileSize.setText(this.mContext.getString(R.string.tap_resend));
                this.mTvDay.setText(this.mContext.getString(R.string.upload_canceled));
                return;
            default:
                this.mTvFileSize.setText(string2 + " " + this.mContext.getString(R.string.tap_openfile));
                return;
        }
    }

    private void setViewAttachFileOrVideo() {
        this.mLlAttachPic.setVisibility(8);
        this.mRlAttachVoice.setVisibility(8);
        this.mLlAttachContact.setVisibility(8);
        this.mLlAttachFile.setVisibility(0);
        this.mbFitChatToThumbnail = false;
    }

    private void setViewAttachPhoto(String str) {
        this.mLlAttachPic.setVisibility(0);
        this.mRlAttachVoice.setVisibility(8);
        this.mLlAttachContact.setVisibility(8);
        this.mLlAttachFile.setVisibility(8);
        String str2 = "";
        if (str.contains("file://")) {
            str = str.replace("file://", "");
        }
        Options options = new Options();
        options.inJustDecodeBounds = true;
        BitmapFactory.decodeFile(str, options);
        int i = options.outWidth;
        int i2 = options.outHeight;
        if (i > i2) {
            this.mRlAttachPic.setLayoutParams(new LayoutParams(BUBBLE_IMAGE_WIDTH_NORMAL, BUBBLE_IMAGE_HEIGHT_LANDSCAPE));
        } else if (i < i2) {
            this.mRlAttachPic.setLayoutParams(new LayoutParams(BUBBLE_IMAGE_WIDTH_NORMAL, BUBBLE_IMAGE_HEIGHT_PORTRAIT));
        } else if (i == i2) {
            this.mRlAttachPic.setLayoutParams(new LayoutParams(BUBBLE_IMAGE_WIDTH_NORMAL, BUBBLE_IMAGE_WIDTH_NORMAL));
        }
        this.mbFitChatToThumbnail = true;
    }

    private void setViewAttachVoice() {
        this.mLlAttachPic.setVisibility(8);
        this.mLlAttachContact.setVisibility(8);
        this.mLlAttachFile.setVisibility(8);
        this.mRlAttachVoice.setVisibility(0);
        if (this.mMsg.getType() == MessageType.BCASTVOICE.ordinal()) {
            this.mRlAttachVoice.setBackgroundResource(R.drawable.bg_attach_bc);
        } else {
            this.mRlAttachVoice.setBackgroundResource(R.drawable.bg_attach);
        }
        this.mbFitChatToThumbnail = false;
    }

    private void updateIconFileThumb(String str) {
        this.mIvThumbFile.setImageResource(AlbusUtils.getIconFileThumb(str));
    }

    public void additionalProcess() {
        if (this.mChatViewType == 2) {
            int likeCount = this.mMsg.getLikeCount();
            if (likeCount > 0) {
                this.mLlLike.setVisibility(0);
                this.mTvLikeCount.setText("" + likeCount);
            } else {
                this.mLlLike.setVisibility(8);
            }
        }
        switch (AnonymousClass3.$SwitchMap$com$catfiz$service$CatfishRESTAPI$MessageType[MessageType.values()[this.mMsg.getType()].ordinal()]) {
            case HttpRouteDirector.TUNNEL_TARGET /*3*/:
            case HttpRouteDirector.TUNNEL_PROXY /*4*/:
                this.mTvChat.setMaxLines(8);
                return;
            default:
                this.mTvChat.setMaxLines(ActivityChooserViewAdapter.MAX_ACTIVITY_COUNT_UNLIMITED);
                LongMessageWorker.cancelPotentialWork(null, this.mTvChat);
                return;
        }
    }

    public void animateGif(View view) {
        if (view instanceof ImageView) {
            String dataFilePath = this.mMsg.getDataFilePath();
            if (dataFilePath != null && !dataFilePath.isEmpty() && Utils.getFileTypeFromPath(dataFilePath) == 1 && Utils.getExtension(dataFilePath).equals(".gif")) {
                try {
                    Drawable drawable = ((ImageView) view).getDrawable();
                    if (drawable != null && (drawable instanceof GifDrawable)) {
                        GifDrawable gifDrawable = (GifDrawable) ((ImageView) view).getDrawable();
                        if (gifDrawable.isRunning()) {
                            gifDrawable.stop();
                        }
                        gifDrawable.recycle();
                    }
                    drawable = new GifDrawable(dataFilePath);
                    ((ImageView) view).setImageDrawable(drawable);
                    drawable.reset();
                    drawable.start();
                    drawable.addAnimationListener(new AnimateGifListener(drawable));
                } catch (OutOfMemoryError e) {
                } catch (IOException e2) {
                    e2.printStackTrace();
                }
            }
        }
    }

    public void onAttachMsg() {
        int i = 0;
        int i2 = 1;
        this.mTvReadMore.setVisibility(8);
        this.mVideoPlayer.setVisibility(8);
        this.mLlQuote.setVisibility(8);
        this.mLlAttachContainer.setVisibility(0);
        String str = "";
        str = this.mChatViewType == 1 ? this.mMsg.getDataFilePath() : this.mMsg.getText();
        String extension = Utils.getExtension(this.mMsg.getDataFilePath());
        if (extension == null) {
            extension = Utils.getExtension(this.mMsg.getImageFilePath());
        }
        if (extension == null) {
            extension = Utils.getExtension(this.mMsg.getVoiceFilePath());
        }
        if (extension == null) {
            extension = "";
        }
        if (this.mChatViewType == 1 && !this.mMsg.getSlink().isEmpty()) {
            i = 1;
        }
        if (!(i == 0 && this.mChatViewType == 2 && this.mMsg.getDeliveryStatus() == MessageDeliveryStatus.BCASTSENT.ordinal())) {
            i2 = i;
        }
        if (i2 != 0) {
            str = str.toLowerCase(Locale.US);
            if (!this.mMsg.getVoiceFilePath().isEmpty() || extension.contains(".amr")) {
                Log.d(TAG, "onAttachMsg - voice/audio");
                str = this.mMsg.getVoiceFilePath();
                if (str.isEmpty()) {
                    str = this.mMsg.getDataFilePath();
                }
                if (!str.isEmpty()) {
                    processAttachedMessage(5, str);
                    this.mTvChat.setVisibility(8);
                }
            } else if (!this.mMsg.getImageFilePath().isEmpty() || !this.mMsg.getImageThumbURI().isEmpty() || str.contains(".jpg") || str.contains(".jpeg") || str.contains(".png") || str.contains(".bmp")) {
                Log.d(TAG, "onAttachMsg - image");
                str = this.mMsg.getImageThumbURI();
                if (!str.isEmpty()) {
                    processAttachedMessage(2, str);
                    Log.d(TAG, "onAttachMsg(), Image:" + this.mMsg.getText());
                    hideShowTvChat(this.mMsg.getText());
                }
            } else if (extension.contains(".gif")) {
                Log.d(TAG, "onAttachMsg - gif");
                str = this.mMsg.getDataFilePath();
                if (str.isEmpty()) {
                    str = this.mMsg.getImageFilePath();
                }
                if (str.isEmpty()) {
                    str = this.mMsg.getImageThumbURI();
                }
                if (!str.isEmpty()) {
                    processAttachedMessage(2, str);
                    hideShowTvChat(this.mMsg.getText());
                }
            } else if (!this.mMsg.getDataFilePath().isEmpty()) {
                Log.d(TAG, "onAttachMsg - File/Video");
                str = this.mMsg.getDataFilePath();
                if (!str.isEmpty()) {
                    processAttachedMessage(4, str);
                    hideShowTvChat(this.mMsg.getText());
                }
            }
        } else {
            str = str.toLowerCase(Locale.US);
            if (!this.mMsg.getImageFilePath().isEmpty() || !this.mMsg.getImageThumbURI().isEmpty() || str.contains(".jpg") || str.contains(".jpeg") || str.contains(".png") || str.contains(".bmp")) {
                Log.d(TAG, "onAttachMsg - else - image");
                str = this.mMsg.getImageThumbURI();
                if (str.isEmpty()) {
                    str = this.mMsg.getDataFilePath();
                }
                if (!str.isEmpty()) {
                    processAttachedMessage(2, str);
                    hideShowTvChat(this.mMsg.getText());
                }
            } else if (!this.mMsg.getVoiceFilePath().isEmpty()) {
                Log.d(TAG, "onAttachMsg - else - voice");
                str = this.mMsg.getVoiceFilePath();
                if (!str.isEmpty()) {
                    processAttachedMessage(5, str);
                    this.mTvChat.setVisibility(8);
                }
            } else if (extension.contains(".gif")) {
                Log.d(TAG, "onAttachMsg - else - gif");
                str = this.mMsg.getDataFilePath();
                if (!str.isEmpty()) {
                    processAttachedMessage(2, str);
                }
                hideShowTvChat(this.mMsg.getText());
            } else {
                Log.d(TAG, "onAttachMsg - else - File/Video");
                str = this.mMsg.getDataFilePath();
                if (!str.isEmpty()) {
                    processAttachedMessage(4, str);
                }
                hideShowTvChat(this.mMsg.getText());
            }
        }
        deliveryUpdate();
        this.mTvChat.setTextColor(this.mContext.getResources().getColor(R.color.black87));
        this.mTvDay.setTextColor(this.mContext.getResources().getColor(R.color.transparent54));
    }

    public void onAttachVideo() {
        Log.d(TAG, "onAttachMsg() Video, text:" + this.mMsg.getText());
        this.mTvReadMore.setVisibility(8);
        this.mLlAttachContainer.setVisibility(0);
        this.mLlQuote.setVisibility(8);
        this.mLlFizzlinkContainer.setVisibility(8);
        this.mbFitChatToThumbnail = true;
        String str = "";
        str = "";
        str = this.mChatViewType == 1 ? this.mMsg.getDataFilePath() : this.mMsg.getText();
        if (!str.isEmpty() && str.contains(".")) {
            str.substring(str.lastIndexOf(".")).toLowerCase(Locale.US);
        }
        boolean z = this.mChatViewType == 1 && !this.mMsg.getSlink().isEmpty();
        if (!z && this.mChatViewType == 2 && this.mMsg.getDeliveryStatus() == MessageDeliveryStatus.BCASTSENT.ordinal()) {
            z = true;
        }
        if (z) {
            this.mVideoPlayer.setVisibility(0);
            Log.d(TAG, "on video attach chat");
            if (!this.mMsg.getDataFilePath().isEmpty()) {
                hideShowTvChat(this.mMsg.getText());
                Fizzlink fizzlink = this.mMsg.getFizzlink();
                this.mVideoPlayer.setParams(this.mMsg.getDataFilePath(), this.mMsg.getSequence(), this.mRoomName, fizzlink.getSenderName(), fizzlink.getDescription(), false);
            }
            if (this.mMsg.getStreamThumbnailStatus() == 1) {
                File thumbStream = CatfishPhotoStorage.getThumbStream(this.mContext, this.mMsg.getSlink());
                if (thumbStream != null) {
                    this.mVideoPlayer.setThumbnail(thumbStream.getAbsolutePath());
                } else {
                    this.mVideoPlayer.setThumbnail(null);
                }
            } else if (this.mMsg.getStreamThumbnailStatus() == 0) {
                this.mVideoPlayer.setThumbnail(null);
                ((ChatGroupConvActivity) this.mContext).streamThumbnailDownload(this.mMsg.getSlink());
            }
        } else {
            this.mVideoPlayer.setVisibility(8);
            str = this.mMsg.getDataFilePath();
            if (!str.isEmpty()) {
                processAttachedMessage(4, str);
            }
            hideShowTvChat(this.mMsg.getText());
        }
        deliveryUpdate();
        this.mTvChat.setTextColor(this.mContext.getResources().getColor(R.color.black87));
        this.mTvDay.setTextColor(this.mContext.getResources().getColor(R.color.transparent54));
    }

    public void onBroadcastMsg() {
        this.mTvReadMore.setVisibility(8);
        this.mLlAttachContainer.setVisibility(8);
        this.mVideoPlayer.setVisibility(8);
        this.mLlQuote.setVisibility(8);
        this.mIvStatus.setVisibility(0);
        this.mbFitChatToThumbnail = false;
        this.mTvChat.setTextColor(this.mContext.getResources().getColor(R.color.white_opaque));
        this.mTvDay.setTextColor(this.mContext.getResources().getColor(R.color.white_opaque));
        deliveryUpdate();
        hideShowTvChat(this.mMsg.getText());
    }

    public void onBroadcastVoiceMsg() {
        this.mTvReadMore.setVisibility(8);
        this.mLlAttachContainer.setVisibility(0);
        this.mVideoPlayer.setVisibility(8);
        this.mLlQuote.setVisibility(8);
        this.mIvStatus.setVisibility(0);
        this.mbFitChatToThumbnail = false;
        if (this.mMsg.getVoiceFilePath().isEmpty()) {
            Log.d(TAG, "No Voice");
            hideAllViewAttach();
        } else {
            Log.d(TAG, "Has Voice=" + this.mMsg.getVoiceFilePath());
            processAttachedMessage(5, this.mMsg.getVoiceFilePath());
        }
        this.mTvChat.setTextColor(this.mContext.getResources().getColor(R.color.white_opaque));
        this.mTvDay.setTextColor(this.mContext.getResources().getColor(R.color.white_opaque));
        deliveryUpdate();
        hideShowTvChat(this.mMsg.getText());
    }

    public void onClick(View view) {
        Log.d(TAG, "onClick:" + view.getId());
        if (getId() != view.getId() || getId() == 0) {
            String voiceFilePath;
            switch (view.getId()) {
                case R.id.ib_play:
                    final AlbusAudioPlayer audioPlayer = ((ChatGroupConvActivity) this.mContext).getAudioPlayer();
                    voiceFilePath = this.mMsg.getVoiceFilePath();
                    if (voiceFilePath.isEmpty()) {
                        voiceFilePath = this.mMsg.getDataFilePath();
                    }
                    audioPlayer.setOnAudioStateChange(new onAudioStateChange() {
                        public void onAudioFinished(int i) {
                            audioPlayer.getDurationHandler().post(new Runnable() {
                                public void run() {
                                    ((ChatGroupConvActivity) ChatItemRightView.this.mContext).refreshData();
                                }
                            });
                        }

                        public void onAudioPaused(int i) {
                            Log.d(ChatItemRightView.TAG, "onAudioPaused:" + i);
                        }

                        public void onAudioPlaying(final int i, final int i2) {
                            audioPlayer.getDurationHandler().post(new Runnable() {
                                public void run() {
                                    ChatItemRightView.this.mSbPlayback.setProgress(i2);
                                    ChatItemRightView.this.mTvDuration.setText(AlbusUtils.milliSecondsToTimer((long) (i - i2)));
                                }
                            });
                        }

                        public void onAudioPrepared(final int i) {
                            audioPlayer.getDurationHandler().post(new Runnable() {
                                public void run() {
                                    ChatItemRightView.this.mIbVoicePlayer.setImageResource(R.drawable.ic_stop_dark);
                                    ChatItemRightView.this.mSbPlayback.setMax(i);
                                }
                            });
                        }

                        public void onAudioStoped(int i, int i2) {
                            audioPlayer.getDurationHandler().post(new Runnable() {
                                public void run() {
                                    ((ChatGroupConvActivity) ChatItemRightView.this.mContext).refreshData();
                                }
                            });
                        }
                    });
                    if (audioPlayer.getPlaying()) {
                        audioPlayer.Stop();
                        if (audioPlayer.getLastPlayedID() != this.mMsg.getSequence()) {
                            audioPlayer.setLastPlayedID(this.mMsg.getSequence());
                            audioPlayer.setDataSouce(voiceFilePath);
                            audioPlayer.Play();
                            return;
                        }
                        return;
                    }
                    audioPlayer.setLastPlayedID(this.mMsg.getSequence());
                    audioPlayer.setDataSouce(voiceFilePath);
                    audioPlayer.Play();
                    return;
                case R.id.ll_fizzlink:
                    this.mItemClickListener.onFizzlinkClicked(this.mMsg);
                    return;
                case R.id.ll_attach_file:
                    switch (AnonymousClass3.$SwitchMap$com$catfiz$service$CatfishRESTAPI$MessageDeliveryStatus[MessageDeliveryStatus.values()[this.mMsg.getDeliveryStatus()].ordinal()]) {
                        case e.b /*1*/:
                        case e.c /*2*/:
                        case HttpRouteDirector.TUNNEL_TARGET /*3*/:
                        case HttpRouteDirector.TUNNEL_PROXY /*4*/:
                            return;
                        default:
                            this.mItemClickListener.onAttachFileClicked(this.mMsg);
                            return;
                    }
                case R.id.iv_attach_file_cancel:
                case R.id.tv_attach_pic_cancel:
                case R.id.iv_voice_cancel:
                    this.mItemClickListener.onAttachCancelClicked(this.mMsg);
                    return;
                case R.id.iv_attach_file_retry:
                case R.id.tv_attach_pic_retry:
                    this.mItemClickListener.onRetryUploadClicked(this.mMsg);
                    return;
                case R.id.iv_thumb_attach_pic:
                case R.id.ib_attach_pic_video_play:
                    switch (AnonymousClass3.$SwitchMap$com$catfiz$service$CatfishRESTAPI$MessageDeliveryStatus[MessageDeliveryStatus.values()[this.mMsg.getDeliveryStatus()].ordinal()]) {
                        case e.b /*1*/:
                        case e.c /*2*/:
                        case HttpRouteDirector.TUNNEL_TARGET /*3*/:
                        case HttpRouteDirector.TUNNEL_PROXY /*4*/:
                            return;
                        default:
                            voiceFilePath = this.mMsg.getDataFilePath();
                            if (voiceFilePath == null || voiceFilePath.isEmpty()) {
                                this.mMsg.getImageFilePath();
                            }
                            this.mItemClickListener.onAttachPicClicked(this.mMsg);
                            return;
                    }
                case R.id.tv_read_more:
                    this.mTvReadMore.setVisibility(8);
                    if (this.mLongMessageWorker != null) {
                        this.mLongMessageWorker.loadMessage(String.valueOf(this.mMsg.getSequence()), this.mTvChat, true);
                        this.mTvChat.setMaxLines(ActivityChooserViewAdapter.MAX_ACTIVITY_COUNT_UNLIMITED);
                        return;
                    }
                    return;
                default:
                    return;
            }
        }
        this.mItemClickListener.onItemChatClicked(this.mMsg);
    }

    public void onContactMsg() {
        this.mTvReadMore.setVisibility(8);
        this.mLlAttachContainer.setVisibility(0);
        this.mVideoPlayer.setVisibility(8);
        this.mLlQuote.setVisibility(8);
        this.mLlAttachContact.setVisibility(0);
        this.mbFitChatToThumbnail = false;
        List listUsersFromJSON = AlbusUtils.getListUsersFromJSON(this.mMsg.getText());
        if (this.mUserPhotoLoader == null || listUsersFromJSON == null) {
            Log.d(TAG, "onContactMsg(), mUserPhotoLoader = null");
        } else if (listUsersFromJSON.size() >= 4) {
            this.mRivSingleContactPic.setVisibility(8);
            this.mRlAttachMultiContact.setVisibility(0);
            this.mUserPhotoLoader.loadFriendPhoto(((User) listUsersFromJSON.get(0)).getId(), this.mRivContactPicTopLeft);
            this.mUserPhotoLoader.loadFriendPhoto(((User) listUsersFromJSON.get(1)).getId(), this.mRivContactPicTopRight);
            this.mUserPhotoLoader.loadFriendPhoto(((User) listUsersFromJSON.get(2)).getId(), this.mRivContactPicBottomLeft);
            this.mUserPhotoLoader.loadFriendPhoto(((User) listUsersFromJSON.get(3)).getId(), this.mRivContactPicBottomRight);
        } else if (listUsersFromJSON.size() == 3) {
            this.mRivSingleContactPic.setVisibility(8);
            this.mRlAttachMultiContact.setVisibility(0);
            this.mUserPhotoLoader.loadFriendPhoto(((User) listUsersFromJSON.get(0)).getId(), this.mRivContactPicTopLeft);
            this.mUserPhotoLoader.loadFriendPhoto(((User) listUsersFromJSON.get(1)).getId(), this.mRivContactPicTopRight);
            this.mUserPhotoLoader.loadFriendPhoto(((User) listUsersFromJSON.get(2)).getId(), this.mRivContactPicBottomLeft);
        } else if (listUsersFromJSON.size() == 2) {
            this.mRivSingleContactPic.setVisibility(8);
            this.mRlAttachMultiContact.setVisibility(0);
            this.mUserPhotoLoader.loadFriendPhoto(((User) listUsersFromJSON.get(0)).getId(), this.mRivContactPicTopLeft);
            this.mUserPhotoLoader.loadFriendPhoto(((User) listUsersFromJSON.get(1)).getId(), this.mRivContactPicTopRight);
        } else if (listUsersFromJSON.size() == 1) {
            this.mRivSingleContactPic.setVisibility(0);
            this.mRlAttachMultiContact.setVisibility(8);
            this.mUserPhotoLoader.loadFriendPhoto(((User) listUsersFromJSON.get(0)).getId(), this.mRivSingleContactPic);
        } else {
            Log.d(TAG, "onContactMsg(), users size = 0");
        }
        this.mTvContactName.setText(this.mContext.getResources().getString(R.string.msg_attach_contact_sent));
        this.mTvContactMsg.setText(this.mContext.getResources().getString(R.string.msg_attach_view_multi_contact));
        this.mTvChat.setTextColor(this.mContext.getResources().getColor(R.color.black87));
        this.mTvDay.setTextColor(this.mContext.getResources().getColor(R.color.transparent54));
        deliveryUpdate();
        this.mTvChat.setVisibility(8);
    }

    public void onFizzlinkMsg() {
        String slinkFromJson;
        this.mLlAttachContainer.setVisibility(0);
        this.mLlQuote.setVisibility(8);
        this.mLlFizzlinkContainer.setVisibility(0);
        this.mVideoPlayer.setVisibility(8);
        this.mTvReadMore.setVisibility(8);
        this.mbFitChatToThumbnail = true;
        deliveryUpdate();
        this.mTvChat.setTextColor(this.mContext.getResources().getColor(R.color.black87));
        this.mTvDay.setTextColor(this.mContext.getResources().getColor(R.color.transparent54));
        this.mTvChat.setVisibility(0);
        this.mTvReadMore.setVisibility(8);
        if (AlbusUtils.getSlinkFromJson(this.mMsg.getText(), ServerMessageDataStorage.SLINK) == null) {
            hideShowTvChat(this.mContext.getString(R.string.upload_fizzlink));
        } else {
            slinkFromJson = AlbusUtils.getSlinkFromJson(this.mMsg.getText(), ServerMessageDataStorage.MESSAGE);
            if (slinkFromJson == null || slinkFromJson.compareTo("") == 0) {
                this.mTvChat.setVisibility(8);
            } else {
                hideShowTvChat(slinkFromJson);
            }
        }
        slinkFromJson = AlbusUtils.getSlinkFromJson(this.mMsg.getText(), FriendListDataStorage.FILENAME);
        CharSequence replace = (slinkFromJson == null || slinkFromJson.isEmpty()) ? "" : slinkFromJson.replace("%20", " ");
        this.mTvFizzTitle.setText(replace);
        this.mTvFizzDesc.setText(AlbusUtils.getSlinkFromJson(this.mMsg.getText(), "filesize") + " - Fizzlink");
        slinkFromJson = AlbusUtils.getSlinkFromJson(this.mMsg.getText(), TaskDataStorage.FILE_PATH);
        if (slinkFromJson != null) {
            this.mIvFizzIcon.setImageResource(AlbusUtils.getIconFileThumb(slinkFromJson));
        }
    }

    public void onNormalMsg(boolean z) {
        this.mLlAttachContainer.setVisibility(8);
        this.mLlQuote.setVisibility(8);
        this.mbFitChatToThumbnail = false;
        deliveryUpdate();
        this.mTvChat.setTextColor(this.mContext.getResources().getColor(R.color.black87));
        this.mTvDay.setTextColor(this.mContext.getResources().getColor(R.color.transparent54));
        this.mTvChat.setVisibility(0);
        if (z) {
            this.mTvReadMore.setVisibility(0);
        } else {
            this.mTvReadMore.setVisibility(8);
        }
        hideShowTvChat(this.mMsg.getText());
    }

    public void onPingMsg() {
        this.mTvReadMore.setVisibility(8);
        this.mMsg.setText(this.mContext.getResources().getString(R.string.blitz));
        onNormalMsg(false);
    }

    public void onPoolContactMsg() {
        this.mTvReadMore.setVisibility(8);
        this.mLlAttachContainer.setVisibility(0);
        this.mVideoPlayer.setVisibility(8);
        this.mLlQuote.setVisibility(8);
        this.mLlAttachContact.setVisibility(0);
        this.mbFitChatToThumbnail = false;
        String text = this.mMsg.getText();
        String str = text.split(":")[0];
        CharSequence substring = text.substring(text.indexOf(":") + 1);
        this.mRivSingleContactPic.setVisibility(0);
        this.mRivSingleContactPic.setImageBitmap(CatfishPhotoStorage.getPromotedFriendProfilePhotoBitmapInPool(this.mContext, str));
        this.mTvContactMsg.setText(this.mContext.getResources().getString(R.string.pool_msg_attach_friend_promoted));
        this.mTvContactName.setText(substring);
        deliveryUpdate();
        this.mTvChat.setVisibility(8);
    }

    public void onQuoteMsg() {
        this.mLlAttachContainer.setVisibility(8);
        this.mLlQuote.setVisibility(0);
        this.mTvReadMore.setVisibility(8);
        this.mbFitChatToThumbnail = false;
        deliveryUpdate();
        this.mTvChat.setTextColor(this.mContext.getResources().getColor(R.color.black87));
        this.mTvDay.setTextColor(this.mContext.getResources().getColor(R.color.transparent54));
        if (QuoteUtils.isQuoteMessage(this.mMsg.getText())) {
            Quote quoteJSONStringDecoder = QuoteUtils.quoteJSONStringDecoder(this.mMsg.getText());
            this.mTvQuoteName.setText(SmiledText.getSmiledText(this.mContext, quoteJSONStringDecoder.getSenderName(), this.mTvQuoteName));
            this.mTvQuote.setText(SmiledText.getSmiledText(this.mContext, '\"' + quoteJSONStringDecoder.getQuoteMessage() + '\"', this.mTvQuote));
            CFLinkify.addLinks(this.mTvQuote, CFLinkify.NIC | 7);
            hideShowTvChat(quoteJSONStringDecoder.getMyMessage());
            return;
        }
        this.mTvQuote.setText("");
        hideShowTvChat("");
    }

    public void setMyLayout(HashMap hashMap, int i) {
        switch (AnonymousClass3.$SwitchMap$com$catfiz$service$CatfishRESTAPI$MessageType[MessageType.values()[this.mMsg.getType()].ordinal()]) {
            case e.b /*1*/:
            case e.c /*2*/:
                if (hashMap.get(Integer.valueOf(i)) == null) {
                    this.mLlBgItemMsg.setBackgroundResource(R.drawable.bc_chat_right_onclick);
                    break;
                } else {
                    this.mLlBgItemMsg.setBackgroundResource(R.drawable.bg_bc_bubble_right);
                    break;
                }
            default:
                if (hashMap.get(Integer.valueOf(i)) == null) {
                    this.mLlBgItemMsg.setBackgroundResource(R.drawable.chat_right_onclick);
                    break;
                } else {
                    this.mLlBgItemMsg.setBackgroundResource(R.drawable.bg_msg_bubble_right_selected);
                    break;
                }
        }
        this.mTvDay.setText(AlbusUtils.getLastChatTimeActivities(this.mMsg.getTimeStamp(), this.mContext, true));
        if (this.mChatViewType == 1) {
            this.mLlLike.setVisibility(8);
        }
        this.mLlAttachContainer.setVisibility(8);
        this.mTvChat.setVisibility(0);
        this.mLlFizzlinkContainer.setVisibility(8);
        this.mVideoPlayer.setVisibility(8);
        hideAllViewAttach();
    }

    public void setOnItemRightClickListener(OnItemRightClickListener onItemRightClickListener) {
        this.mItemClickListener = onItemRightClickListener;
    }

    public void setOnItemRightLongClickListener(OnItemRightLongClickListener onItemRightLongClickListener) {
        this.mItemLongClickListener = onItemRightLongClickListener;
    }

    public void setParams(int i, String str) {
        this.mChatViewType = i;
        this.mUserPhotoLoader = ((ChatGroupConvActivity) this.mContext).getUserPhotoLoader();
        this.mLongMessageWorker = ((ChatGroupConvActivity) this.mContext).getLongMessageWorker();
        this.mThumbnailLoader = ((ChatGroupConvActivity) this.mContext).getThumbnailLoader();
        this.mRoomName = str;
    }

    public void setTag(Message message) {
        super.setTag(message);
        this.mIbVoicePlayer.setTag(message);
        this.mFileCancel.setTag(message);
        this.mIvThumbPic.setTag(message);
        this.mLlAttachFile.setTag(message);
        this.mLlFizzlinkContainer.setTag(message);
        this.mMsg = message;
        this.mMessageKey = null;
        if (this.mMsg != null && this.mMsg.getSender() != null && this.mMsg.getSequence() != 0) {
            User sender = this.mMsg.getSender();
            if (sender != null && sender.getId() != null) {
                this.mMessageKey = CacheKeys.convtextkey(sender.getId(), this.mMsg.getSequence());
            }
        }
    }
}
