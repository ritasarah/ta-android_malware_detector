package com.b.a.d.b;

import com.b.a.c.a.c;
import com.b.a.c.b;
import com.b.a.c.g;
import com.b.a.c.i;
import com.b.a.n;
import com.b.a.u;
import java.util.ArrayList;
import java.util.Collections;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;

public final class a {
    private final b a;
    private final c b;

    public a(b bVar) {
        this.a = bVar;
        this.b = new c(bVar);
    }

    private static int a(u uVar, u uVar2) {
        return com.b.a.c.a.a.a(u.distance(uVar, uVar2));
    }

    private static b a(b bVar, u uVar, u uVar2, u uVar3, u uVar4, int i, int i2) {
        return i.a().a(bVar, i, i2, 0.5f, 0.5f, ((float) i) - 0.5f, 0.5f, ((float) i) - 0.5f, ((float) i2) - 0.5f, 0.5f, ((float) i2) - 0.5f, uVar.getX(), uVar.getY(), uVar4.getX(), uVar4.getY(), uVar3.getX(), uVar3.getY(), uVar2.getX(), uVar2.getY());
    }

    private u a(u uVar, u uVar2, u uVar3, u uVar4, int i) {
        float a = ((float) a(uVar, uVar2)) / ((float) i);
        int a2 = a(uVar3, uVar4);
        u uVar5 = new u((((uVar4.getX() - uVar3.getX()) / ((float) a2)) * a) + uVar4.getX(), (a * ((uVar4.getY() - uVar3.getY()) / ((float) a2))) + uVar4.getY());
        float a3 = ((float) a(uVar, uVar3)) / ((float) i);
        int a4 = a(uVar2, uVar4);
        u uVar6 = new u((((uVar4.getX() - uVar2.getX()) / ((float) a4)) * a3) + uVar4.getX(), (a3 * ((uVar4.getY() - uVar2.getY()) / ((float) a4))) + uVar4.getY());
        return !a(uVar5) ? a(uVar6) ? uVar6 : null : (!a(uVar6) || Math.abs(b(uVar3, uVar5).c() - b(uVar2, uVar5).c()) <= Math.abs(b(uVar3, uVar6).c() - b(uVar2, uVar6).c())) ? uVar5 : uVar6;
    }

    private u a(u uVar, u uVar2, u uVar3, u uVar4, int i, int i2) {
        float a = ((float) a(uVar, uVar2)) / ((float) i);
        int a2 = a(uVar3, uVar4);
        u uVar5 = new u((((uVar4.getX() - uVar3.getX()) / ((float) a2)) * a) + uVar4.getX(), (a * ((uVar4.getY() - uVar3.getY()) / ((float) a2))) + uVar4.getY());
        float a3 = ((float) a(uVar, uVar3)) / ((float) i2);
        int a4 = a(uVar2, uVar4);
        u uVar6 = new u((((uVar4.getX() - uVar2.getX()) / ((float) a4)) * a3) + uVar4.getX(), (a3 * ((uVar4.getY() - uVar2.getY()) / ((float) a4))) + uVar4.getY());
        return !a(uVar5) ? a(uVar6) ? uVar6 : null : !a(uVar6) ? uVar5 : Math.abs(i - b(uVar3, uVar5).c()) + Math.abs(i2 - b(uVar2, uVar5).c()) <= Math.abs(i - b(uVar3, uVar6).c()) + Math.abs(i2 - b(uVar2, uVar6).c()) ? uVar5 : uVar6;
    }

    private static void a(Map map, u uVar) {
        Integer num = (Integer) map.get(uVar);
        map.put(uVar, Integer.valueOf(num == null ? 1 : num.intValue() + 1));
    }

    private boolean a(u uVar) {
        return uVar.getX() >= 0.0f && uVar.getX() < ((float) this.a.e()) && uVar.getY() > 0.0f && uVar.getY() < ((float) this.a.f());
    }

    private c b(u uVar, u uVar2) {
        int x = (int) uVar.getX();
        int y = (int) uVar.getY();
        int x2 = (int) uVar2.getX();
        int y2 = (int) uVar2.getY();
        Object obj = Math.abs(y2 - y) > Math.abs(x2 - x) ? 1 : null;
        if (obj == null) {
            int i = y2;
            y2 = x2;
            x2 = i;
            int i2 = y;
            y = x;
            x = i2;
        }
        int abs = Math.abs(y2 - y);
        int abs2 = Math.abs(x2 - x);
        int i3 = (-abs) >> 1;
        int i4 = x < x2 ? 1 : -1;
        int i5 = y < y2 ? 1 : -1;
        int i6 = 0;
        boolean a = this.a.a(obj != null ? x : y, obj != null ? y : x);
        int i7 = x;
        int i8 = i3;
        while (y != y2) {
            boolean a2 = this.a.a(obj != null ? i7 : y, obj != null ? y : i7);
            if (a2 != a) {
                i6++;
                a = a2;
            }
            x = i8 + abs2;
            if (x > 0) {
                if (i7 == x2) {
                    x2 = i6;
                    break;
                }
                i7 += i4;
                x -= abs;
            }
            y += i5;
            i8 = x;
        }
        x2 = i6;
        return new c(uVar, uVar2, x2);
    }

    public g a() {
        u[] a = this.b.a();
        u uVar = a[0];
        u uVar2 = a[1];
        u uVar3 = a[2];
        u uVar4 = a[3];
        List arrayList = new ArrayList(4);
        arrayList.add(b(uVar, uVar2));
        arrayList.add(b(uVar, uVar3));
        arrayList.add(b(uVar2, uVar4));
        arrayList.add(b(uVar3, uVar4));
        Collections.sort(arrayList, new d());
        c cVar = (c) arrayList.get(0);
        c cVar2 = (c) arrayList.get(1);
        Map hashMap = new HashMap();
        a(hashMap, cVar.a());
        a(hashMap, cVar.b());
        a(hashMap, cVar2.a());
        a(hashMap, cVar2.b());
        u uVar5 = null;
        u uVar6 = null;
        u uVar7 = null;
        for (Entry entry : hashMap.entrySet()) {
            u uVar8;
            u uVar9 = (u) entry.getKey();
            if (((Integer) entry.getValue()).intValue() == 2) {
                uVar8 = uVar9;
                uVar9 = uVar7;
                uVar7 = uVar5;
            } else if (uVar5 == null) {
                uVar8 = uVar6;
                u uVar10 = uVar7;
                uVar7 = uVar9;
                uVar9 = uVar10;
            } else {
                uVar8 = uVar6;
                uVar7 = uVar5;
            }
            uVar6 = uVar8;
            uVar5 = uVar7;
            uVar7 = uVar9;
        }
        if (uVar5 == null || uVar6 == null || uVar7 == null) {
            throw n.a();
        }
        b a2;
        a = new u[]{uVar5, uVar6, uVar7};
        u.orderBestPatterns(a);
        uVar7 = a[0];
        uVar9 = a[1];
        uVar6 = a[2];
        uVar5 = !hashMap.containsKey(uVar) ? uVar : !hashMap.containsKey(uVar2) ? uVar2 : !hashMap.containsKey(uVar3) ? uVar3 : uVar4;
        int c = b(uVar6, uVar5).c();
        int c2 = b(uVar7, uVar5).c();
        if ((c & 1) == 1) {
            c++;
        }
        c += 2;
        if ((c2 & 1) == 1) {
            c2++;
        }
        int i = c2 + 2;
        int c3;
        if (c * 4 >= i * 7 || i * 4 >= c * 7) {
            uVar4 = a(uVar9, uVar7, uVar6, uVar5, c, i);
            if (uVar4 == null) {
                uVar4 = uVar5;
            }
            c3 = b(uVar6, uVar4).c();
            int c4 = b(uVar7, uVar4).c();
            if ((c3 & 1) == 1) {
                c3++;
            }
            if ((c4 & 1) == 1) {
                c4++;
            }
            a2 = a(this.a, uVar6, uVar9, uVar7, uVar4, c3, c4);
        } else {
            uVar4 = a(uVar9, uVar7, uVar6, uVar5, Math.min(i, c));
            if (uVar4 == null) {
                uVar4 = uVar5;
            }
            c3 = Math.max(b(uVar6, uVar4).c(), b(uVar7, uVar4).c()) + 1;
            if ((c3 & 1) == 1) {
                c3++;
            }
            a2 = a(this.a, uVar6, uVar9, uVar7, uVar4, c3, c3);
        }
        return new g(a2, new u[]{uVar6, uVar9, uVar7, uVar4});
    }
}
