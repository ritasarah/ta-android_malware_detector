package rapid.decoder.b;

import android.graphics.Bitmap;
import java.lang.ref.WeakReference;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map.Entry;
import rapid.decoder.C0029t;
import rapid.decoder.p;
import rapid.decoder.q;

public class a extends m {
    private HashMap a = new HashMap();
    private HashMap b = new HashMap();

    public a(int i) {
        super(i);
    }

    private void j() {
        Iterator it = this.a.entrySet().iterator();
        while (it.hasNext()) {
            Bitmap bitmap = (Bitmap) ((WeakReference) ((Entry) it.next()).getValue()).get();
            if (bitmap == null || bitmap.isRecycled()) {
                it.remove();
            }
        }
    }

    private void k() {
        Iterator it = this.b.entrySet().iterator();
        while (it.hasNext()) {
            if (((c) ((Entry) it.next()).getValue()).c.isEmpty()) {
                it.remove();
            }
        }
    }

    protected int a(p pVar, Bitmap bitmap) {
        return C0029t.a(bitmap);
    }

    public Bitmap a(p pVar) {
        Bitmap bitmap = (Bitmap) super.b(pVar);
        if (bitmap != null) {
            if (!bitmap.isRecycled()) {
                return bitmap;
            }
            c(pVar);
        }
        WeakReference weakReference = (WeakReference) this.a.get(pVar);
        if (weakReference == null) {
            if (Math.random() <= 0.2d) {
                j();
            }
            return null;
        }
        bitmap = (Bitmap) weakReference.get();
        if (bitmap != null && !bitmap.isRecycled()) {
            return bitmap;
        }
        this.a.remove(pVar);
        return null;
    }

    public q a(Object obj) {
        c cVar = (c) this.b.get(obj);
        if (cVar == null) {
            if (Math.random() <= 0.2d) {
                k();
            }
            return null;
        } else if (!cVar.c.isEmpty()) {
            return cVar;
        } else {
            this.b.remove(obj);
            return null;
        }
    }

    protected void a(boolean z, p pVar, Bitmap bitmap, Bitmap bitmap2) {
        if (!bitmap.isRecycled()) {
            this.a.put(pVar, new WeakReference(bitmap));
        }
    }

    public Bitmap b(p pVar, Bitmap bitmap) {
        Bitmap bitmap2 = (Bitmap) super.b(pVar, bitmap);
        Object E = pVar.E();
        if (E != null) {
            c cVar = (c) this.b.get(E);
            if (cVar == null) {
                cVar = new c();
                this.b.put(E, cVar);
            }
            cVar.a = pVar.j();
            cVar.b = pVar.k();
            cVar.c.put(bitmap, null);
        }
        return bitmap2;
    }

    public /* synthetic */ Object b(Object obj) {
        return a((p) obj);
    }
}
